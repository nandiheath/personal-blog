<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è¸©å‘æ—¥è¨˜</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.nandiheath.com/"/>
  <updated>2019-09-18T09:13:44.717Z</updated>
  <id>https://blog.nandiheath.com/</id>
  
  <author>
    <name>Nandi Wong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åˆ©ç”¨TravisCIç›´æ¥ç™¼ä½ˆéœæ…‹ç¶²é åˆ°Github Pagesä¸Š</title>
    <link href="https://blog.nandiheath.com/2019/09/18/travisci-publish-github-pages/"/>
    <id>https://blog.nandiheath.com/2019/09/18/travisci-publish-github-pages/</id>
    <published>2019-09-18T09:13:44.717Z</published>
    <updated>2019-09-18T09:13:44.717Z</updated>
    
    <content type="html"><![CDATA[<p>github æœ‰ä¸€å€‹å·¥å…·è®“ä½ å¯ä»¥å­˜æ”¾ä¸€äº›ç°¡å–®çš„éœæ…‹ç¶²é </p><ul><li><a href="https://pages.github.com/" target="_blank" rel="noopener">Github Pages</a></li><li><a href="https://help.github.com/articles/what-is-github-pages/" target="_blank" rel="noopener">ä»€éº¼æ˜¯Github Pages</a></li></ul><p>è€Œä¸”æ˜¯å®Œå…¨å…è²»ï¼(ç•¶ç„¶æœ‰å¹¾å€‹é™„å¸¶çš„æ¢ä»¶)</p><ul><li>1GBå®¹é‡</li><li>åªæ”¯æŒéœæ…‹ç¶²é (html/css/jsç­‰)</li><li>æ¯æœˆ100GBæµé‡</li><li><a href="https://help.github.com/articles/what-is-github-pages/" target="_blank" rel="noopener">â€¦</a></li></ul><p>åªè¦ä½ åœ¨githubçš„repoä¸­æ”¾ä¸Šä½ çš„ç¶²é  (å¦‚index.html)<br>ä½ å°±å¯ä»¥åœ¨ https://[username].github.io/[repo_name] ä¸­çœ‹åˆ°ä½ æ”¾ä¸Šå»çš„ç¶²ç«™<br>äº¦å¯ä»¥è¨­å®šä¸€å€‹é¦–é <br>åªè¦repoçš„åå­—æ˜¯ <strong>[username].github.io</strong><br>ä½ å°±å¯ä»¥ç›´æ¥åœ¨ <code>https://[username].github.io</code> çœ‹åˆ°ä½ çš„ç¶²ç«™äº†</p><a id="more"></a><h2 id="Githubè¨­å®š"><a href="#Githubè¨­å®š" class="headerlink" title="Githubè¨­å®š"></a>Githubè¨­å®š</h2><p>Github Page é è¨­æ˜¯æŠŠä½ <code>master</code>ã€€branchä¸­çš„æª”æ¡ˆç™¼ä½ˆåˆ°ç«™ä¸Š<br>ä½†åŒæ™‚äº¦æä¾›äº†å¦å¤–å¹¾ç¨®æ–¹æ³•å»<a href="https://help.github.com/articles/configuring-a-publishing-source-for-github-pages/" target="_blank" rel="noopener">è¨­å®šç™¼ä½ˆçš„ä¾†æº</a></p><blockquote><p>You can configure GitHub Pages to publish your siteâ€™s source files from <code>master</code>, <code>gh-pages</code>, or a <code>/docs</code> folder on your <code>master</code> branch for Project Pages and other Pages sites that meet certain criteria.</p></blockquote><p>å› ç‚ºæˆ‘çš„repoæœ‰å…¶ä»–çš„æºç¢¼<br>æ‰€ä»¥é€™é‚Šæˆ‘å°±é¸äº†ç”¨gh-pagesä¾†ç™¼ä½ˆ</p><p><img src="/images/travisci-publish-github-pages-01.png" alt=""><em>åªè¦åœ¨sourceé‚£é‚Šé¸ç”¨gh-pagesä¾†ç™¼ä½ˆå°±å¯ä»¥äº†</em></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆclone repo</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:[username]/[repo].git</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="built_in">cd</span> [repository]</span><br><span class="line"></span><br><span class="line"><span class="comment"># checkout ä¸€æ¢æ–°çš„orphan branch</span></span><br><span class="line">git checkout --orphan gh-pages</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸¦æŠŠä»–æ¨åˆ°github ä¸Š</span></span><br><span class="line">git push origin gh-pages</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹‹å¾Œçš„ç¶²ç«™å…§å®¹éƒ½æ”¾åˆ°gh-pagesé€™æ¢branch ç•¶ä¸­</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><a href="https://help.github.com/articles/creating-project-pages-using-the-command-line/" target="_blank" rel="noopener"><em>Githubä¸Šçš„æ•™å­¸</em></a></p><p>é€™é‚Šè¦ç”¨åˆ°orphan branchçš„åŸå› æ˜¯å› ç‚ºéœæ…‹ç¶²ç«™ä¸¦ä¸éœ€è¦ä½ çš„æºç¢¼<br>æˆ‘å€‘åªéœ€æŠŠtravisè¨­å®šæˆæŠŠç¶²ç«™çš„æºç¢¼buildèµ·ä¾†ä¹‹å¾ŒåŠ åˆ°é€™æ¢branchä¸­å°±å¯ä»¥äº†<br>å…¶ä¸­çš„æª”æ¡ˆè·Ÿæœ¬ä¾†çš„master branchæ˜¯å®Œå…¨ç¨ç«‹çš„<br>ç°¡å–®ä¾†èªªå°±æ˜¯<code>master</code> branchä¸­åªæœ‰æºç¢¼ï¼Œbuild folderæ˜¯è™•æ–¼<code>.gitignore</code>çš„ç‹€æ…‹<br>è€Œ<code>gh-pages</code>ç•¶ä¸­åªæœ‰æ¯æ¬¡ci buildå®Œçš„ç¶²ç«™ï¼Œè·Ÿ<code>master</code> branchæ˜¯å®Œå…¨æ²’æœ‰é—œé€£</p><p><img src="/images/travisci-publish-github-pages-02.png" alt=""><em>æ‰€ä»¥ä½ æœƒåœ¨gitä¸­çœ‹åˆ°ä»¥ä¸Šçš„ç•«é¢</em></p><h2 id="TravisCI-è¨­å®š"><a href="#TravisCI-è¨­å®š" class="headerlink" title="TravisCI è¨­å®š"></a>TravisCI è¨­å®š</h2><p>ä¸‹ä¸€æ­¥å°±æ˜¯è¨­å®štravis-ci<br>é€™è£¡æ˜¯åœ¨deploy stageä¸­åŠ å…¥äº†ä»¥ä¸‹çš„è¨­å®š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">- stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span> <span class="comment"># build vue</span></span><br><span class="line"><span class="attr">  deploy:</span></span><br><span class="line"><span class="attr">    provider:</span> <span class="string">pages</span> <span class="comment">#</span></span><br><span class="line"><span class="attr">    skip-cleanup:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">    github-token:</span> <span class="string">$GITHUB_TOKEN</span>  <span class="comment"># åœ¨githubä¸­ç”Ÿæˆçš„Personal access token</span></span><br><span class="line"><span class="attr">    keep-history:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    local-dir:</span> <span class="string">web/dist</span> <span class="comment"># buildå®Œä¹‹å¾Œçš„ç›®éŒ„ï¼Œç›´æ¥å¾repo rooté–‹å§‹è¨ˆç®—</span></span><br><span class="line"><span class="attr">    on:</span></span><br><span class="line"><span class="attr">      branch:</span> <span class="string">master</span> <span class="comment">#ã€€åªæœ‰master branchæ‰æŠŠç¶²ç«™ç™¼ä½ˆåˆ°github pageä¸Š</span></span><br></pre></td></tr></table></figure><p>ç„¶å¾Œå†åœ¨travisciä¸­è¨­å®šä½ çš„github access token<code>GITHUB_TOKEN</code>å°±å®Œæˆäº†</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;github æœ‰ä¸€å€‹å·¥å…·è®“ä½ å¯ä»¥å­˜æ”¾ä¸€äº›ç°¡å–®çš„éœæ…‹ç¶²é &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://pages.github.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Github Pages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.github.com/articles/what-is-github-pages/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä»€éº¼æ˜¯Github Pages&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œä¸”æ˜¯å®Œå…¨å…è²»ï¼(ç•¶ç„¶æœ‰å¹¾å€‹é™„å¸¶çš„æ¢ä»¶)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1GBå®¹é‡&lt;/li&gt;
&lt;li&gt;åªæ”¯æŒéœæ…‹ç¶²é (html/css/jsç­‰)&lt;/li&gt;
&lt;li&gt;æ¯æœˆ100GBæµé‡&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.github.com/articles/what-is-github-pages/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;â€¦&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªè¦ä½ åœ¨githubçš„repoä¸­æ”¾ä¸Šä½ çš„ç¶²é  (å¦‚index.html)&lt;br&gt;ä½ å°±å¯ä»¥åœ¨ https://[username].github.io/[repo_name] ä¸­çœ‹åˆ°ä½ æ”¾ä¸Šå»çš„ç¶²ç«™&lt;br&gt;äº¦å¯ä»¥è¨­å®šä¸€å€‹é¦–é &lt;br&gt;åªè¦repoçš„åå­—æ˜¯ &lt;strong&gt;[username].github.io&lt;/strong&gt;&lt;br&gt;ä½ å°±å¯ä»¥ç›´æ¥åœ¨ &lt;code&gt;https://[username].github.io&lt;/code&gt; çœ‹åˆ°ä½ çš„ç¶²ç«™äº†&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="ci" scheme="https://blog.nandiheath.com/categories/devops/ci/"/>
    
    
      <category term="ci" scheme="https://blog.nandiheath.com/tags/ci/"/>
    
      <category term="travisci" scheme="https://blog.nandiheath.com/tags/travisci/"/>
    
      <category term="github" scheme="https://blog.nandiheath.com/tags/github/"/>
    
      <category term="github-pages" scheme="https://blog.nandiheath.com/tags/github-pages/"/>
    
  </entry>
  
  <entry>
    <title>cert-manager-with-kubernetes-ingress</title>
    <link href="https://blog.nandiheath.com/2019/03/29/cert-manager-with-kubernetes-ingress/"/>
    <id>https://blog.nandiheath.com/2019/03/29/cert-manager-with-kubernetes-ingress/</id>
    <published>2019-03-29T07:15:19.000Z</published>
    <updated>2019-09-18T09:13:44.707Z</updated>
    
    <content type="html"><![CDATA[<p>èªªèµ·å…è²»çš„HTTPS cert<br>å¾ˆå¤šäººéƒ½æœƒç”¨letâ€™s encryptçš„æœå‹™<br>åŸå› æ˜¯ç°¡å–®ï¼Œæ˜“ç”¨<br>åœ¨VMä¸Šè£ä¸€å€‹scriptç„¶å¾Œç°¡å–®é…ç½®ä¸€ä¸‹nginxå°±å¯ä»¥ç”Ÿæˆä¸€å¼µæ•¸å€‹æœˆçš„ssl certificate</p><p>ä½†ç•¶ä¾†åˆ°kuberneteså°±æœ‰é»éº»ç…©<br>åŸå› æ˜¯ä½ é…ç½®çš„æœå‹™å¾ˆå¤šå¯èƒ½éƒ½ä¸åœ¨åŒä¸€éƒ¨æ©Ÿä¸Š<br>ç•¶ä½ ç”Ÿæˆäº†ä¸€å¼µssl certä¹‹å¾Œå¯èƒ½è¦æ‰‹å‹•å»æ›´æ–°ç›¸æ‡‰çš„é…ç½®<br>è€Œä¸”è¦å»ºç«‹è‡ªå‹•æ›´æ–°é›£åº¦æ›´å¤§</p><p>æ‰€ä»¥é€™æ™‚ä¾¯å°±å¯ä»¥ç”¨åˆ°cert-manageräº†<br><a href="https://github.com/jetstack/cert-manager" target="_blank" rel="noopener">https://github.com/jetstack/cert-manager</a><br>ä»–æ˜¯ä¸€å€‹k8sçš„addon<br>å¯ä»¥ç”Ÿæˆä¸€ç³»åˆ—çš„resourceså»å¹«ä»¥ä¸Šçš„é…ç½®è‡ªå‹•åŒ–<br>è€Œä¸”é™¤äº†letâ€™s encryptä¹‹å¤–ä¹Ÿæ”¯æŒå…¶ä»–çš„ssl certç™¼è¡Œè€…</p><p>å¦‚æœæ˜¯ç”¨letâ€™s encryptçš„è©±<br>åŸç†å¤§è‡´å¦‚ä¸‹</p><p>é¦–å…ˆä½ æœƒç”Ÿæˆä¸€å€‹ingress<br>ä¸¦åŠ ä¸€äº›ç‰¹æ®Šçš„annotationå»è¡¨æ˜ä½ æƒ³cert-managerå»å¹«ä½ é…ç½®ssl cert<br>åœ¨é€™é‚Šä½ éœ€è¦å…ˆæŒ‡å®šä¸€å€‹secretï¼Œè®“cert-manageræŠŠé…ç½®å¥½çš„sslå­˜æ”¾åœ¨è£¡é¢</p><p>ä¹‹å¾Œcert-manageræ¥æ”¶åˆ°ç›¸æ‡‰çš„äº‹ä»¶è§¸ç™¼å¾Œå°±æœƒé–‹å§‹å·¥ä½œæµç¨‹<br>ä»–æœƒå…ˆå»ºç«‹ä¸€å¼µself-signedçš„ssl certä¸¦æ”¾åœ¨è©²secretè£¡é¢<br>é€™å€‹æ™‚ä¾¯ä½ å»è¨ªå•ingresså°±æœƒç™¼ç¾httpså·²ç¶“èƒ½å¤ ä½¿ç”¨<br>ä½†ssl certæ˜¯ä¸è¢«ç€è¦½å™¨ä¿¡ä»»çš„</p><p>ç„¶å¾Œcert-manageræœƒå»ºç«‹ä¸€å€‹æš«æ™‚çš„ingress<br>å»æ¥æ”¶ä¾†è‡ªletâ€™s encryptçš„acme challenge<br>å»è­‰æ˜ä½ æ“æœ‰è©²åŸŸå<br>å¦‚æœé©—è­‰æˆåŠŸçš„è©±å°±æœƒç”Ÿæˆä¸€å¼µæ­£ç¢ºçš„ssl certä¸¦æ›´æ–°secret<br>ä¹‹å¾Œä½ å†è¨ªå•httpså°±æœƒçœ‹åˆ°é–é ­äº†</p><p>å¯¦éš›æ“ä½œé€™é‚Šå°±æ‡¶å¾—èªªäº†<br>ç›´æ¥çœ‹é€™è£¡<br><a href="https://docs.cert-manager.io/en/latest/tutorials/acme/quick-start/index.html" target="_blank" rel="noopener">https://docs.cert-manager.io/en/latest/tutorials/acme/quick-start/index.html</a></p><p>æœ‰ä¸€é»ç¯„ä¾‹æ²’æœ‰èªªæ¸…æ¥š<br>ä½†å»è‡³é—œé‡è¦ï¼Œå› ç‚ºä½ å¦‚ä½ æ˜¯ç”¨nginx-ingressçš„è©±å¥½æœ‰å¯èƒ½æœƒå‡ºç¾é€™å€‹å•é¡Œ</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">example</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">certmanager.k8s.io/cluster-issuer:</span> <span class="string">"letsencrypt-prod"</span></span><br><span class="line">    <span class="string">certmanager.k8s.io/acme-challenge-type:</span> <span class="string">http01</span></span><br><span class="line">    <span class="string">certmanager.k8s.io/acme-http01-edit-in-place:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  tls:</span></span><br><span class="line"><span class="attr">  - hosts:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">a1.example.com</span></span><br><span class="line"><span class="attr">    secretName:</span> <span class="string">al-example-com-tls</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">a1.example.com</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/api</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>ç•¶ä¸­<code>certmanager.k8s.io/acme-http01-edit-in-place: &quot;true&quot;</code><br>é€™å¥æ˜¯å¾ˆé‡è¦çš„</p><p>å› ç‚ºnginx-ingressæ˜¯ä¸èƒ½å¦‚æ™‚æ¥å—å…©å€‹ingress resources<br>å°±æ˜¯å¦‚æœä½ æœ‰å…©å€‹ingressï¼Œè€Œå…©å€‹éƒ½æœ‰åŒä¸€å€‹hostçš„è©±<br>åªæœ‰å…¶ä¸­ä¸€å€‹èƒ½é‹è¡Œï¼Œå¦ä¸€å€‹å‰‡ç„¡æ•ˆ<br>å¤§æ¦‚çŒœåˆ°åŸå› æ˜¯nginxçš„é…ç½®æœ‰é—œ<br>å› ç‚ºnginx-ingress-controlleræœƒæ¥æ”¶ingressçš„é…ç½®ä¸¦ä¸”åœ¨<code>/etc/nginx/conf.d</code>ä¸­ç”Ÿæˆé…ç½®æ–‡ä»¶</p><p>è€Œcert-manageré è¨­æ˜¯acme-challengeræœƒç”Ÿæˆå¦ä¸€å€‹ingressè³‡æºå‡ºä¾†<br>æ‰€ä»¥ä½ è¦æŠŠé€™å€‹é…ç½®è¨­å®šæˆtrueï¼Œç›®çš„å°±æ˜¯å¸Œæœ›cert-managerå»æ›´æ”¹åŸæœ¬çš„ingress<br>ä¸”ä¸æ˜¯æ–°é–‹å¦ä¸€å€‹å‡ºä¾†</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;èªªèµ·å…è²»çš„HTTPS cert&lt;br&gt;å¾ˆå¤šäººéƒ½æœƒç”¨letâ€™s encryptçš„æœå‹™&lt;br&gt;åŸå› æ˜¯ç°¡å–®ï¼Œæ˜“ç”¨&lt;br&gt;åœ¨VMä¸Šè£ä¸€å€‹scriptç„¶å¾Œç°¡å–®é…ç½®ä¸€ä¸‹nginxå°±å¯ä»¥ç”Ÿæˆä¸€å¼µæ•¸å€‹æœˆçš„ssl certificate&lt;/p&gt;
&lt;p&gt;ä½†ç•¶ä¾†åˆ°kuberneteså°±æœ‰é»éº»ç…©&lt;
      
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="aws" scheme="https://blog.nandiheath.com/tags/aws/"/>
    
      <category term="ingress" scheme="https://blog.nandiheath.com/tags/ingress/"/>
    
      <category term="cert-manager" scheme="https://blog.nandiheath.com/tags/cert-manager/"/>
    
      <category term="letsencrypt" scheme="https://blog.nandiheath.com/tags/letsencrypt/"/>
    
  </entry>
  
  <entry>
    <title>deploy-npm-package-with-travis</title>
    <link href="https://blog.nandiheath.com/2019/03/19/deploy-npm-package-with-travis/"/>
    <id>https://blog.nandiheath.com/2019/03/19/deploy-npm-package-with-travis/</id>
    <published>2019-03-19T09:14:03.000Z</published>
    <updated>2019-09-18T09:13:44.709Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ–¹æ³•ä¸€-åˆ©ç”¨traviså…§ç½®çš„deploy-provider"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨traviså…§ç½®çš„deploy-provider" class="headerlink" title="æ–¹æ³•ä¸€: åˆ©ç”¨traviså…§ç½®çš„deploy provider"></a>æ–¹æ³•ä¸€: åˆ©ç”¨traviså…§ç½®çš„deploy provider</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Login the travis.com</span></span><br><span class="line">travis login --com</span><br><span class="line"></span><br><span class="line"><span class="comment"># encrypt the API_KEY for travis API</span></span><br><span class="line">travis encrypt [NPM_API_KEY] --com --add <span class="string">'deploy.api_key'</span></span><br></pre></td></tr></table></figure><p>é€™å€‹å‘½ä»¤æœƒåœ¨.travis-ci.yamlä¸­åŠ å…¥ä¸€å€‹deployçš„secret<br>è‹¥æœæ˜¯å…¬é–‹çš„repoæœ€å¥½æŠŠå®ƒæŠ½å‡ºä¾†ä»¥ç’°å¢ƒè®Šæ•¸çš„å½¢å¼å»è¼‰å…¥</p><p>ä½†é€™å€‹å¦‚æœç”¨ç’°å¢ƒè®Šæ•¸çš„è©±ä¸çŸ¥ç‚ºä½•ç¸½æ˜¯è·‘å‡º<figure class="highlight plain"><figcaption><span>Unauthorized you must be logged in to publish packages travis```</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">æäº†ä¸€è¼ªä¹‹å¾Œæ±ºå®šç”¨ç¬¬äºŒå€‹æ–¹æ³•</span><br><span class="line"></span><br><span class="line">## æ–¹æ³•äºŒ: deploy scriptåŠåˆ©ç”¨.npmrc</span><br><span class="line"></span><br><span class="line">æ–°å¢ä¸€å€‹deploy.sh</span><br><span class="line">```bash</span><br><span class="line">echo &quot;//registry.npmjs.org/:_authToken=$&#123;NPM_API_TOKEN&#125;&quot; &gt; $HOME/.npmrc</span><br><span class="line"></span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure></p><p>é€™æœƒå°‡ç’°å¢ƒè®Šæ•¸å¯«æˆnpmrc<br>è€Œnpm scriptæœƒåˆ©ç”¨å®ƒä¾†èªè­‰ä¸¦ç™¼ä½ˆ</p><p>æª”æ¡ˆå¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'11'</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'10'</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'8'</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  if:</span> <span class="string">branch</span> <span class="string">=</span> <span class="string">master</span></span><br><span class="line"><span class="attr">cache:</span> <span class="string">npm</span></span><br><span class="line"><span class="comment"># Use script instead of npm provider as it cannot auth via env variables?</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  provider:</span> <span class="string">script</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">"./deploy.sh"</span></span><br><span class="line"><span class="attr">  skip_cleanup:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># only on tagged builds</span></span><br><span class="line"><span class="attr">  on:</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># Send an email when a new version is released</span></span><br><span class="line"><span class="attr">notifications:</span></span><br><span class="line"><span class="attr">  email:</span></span><br><span class="line"><span class="attr">    recipients:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"$NPM_EMAIL"</span></span><br><span class="line"><span class="attr">    on_success:</span> <span class="string">change</span></span><br><span class="line"><span class="attr">    on_failure:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><p>- </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ–¹æ³•ä¸€-åˆ©ç”¨traviså…§ç½®çš„deploy-provider&quot;&gt;&lt;a href=&quot;#æ–¹æ³•ä¸€-åˆ©ç”¨traviså…§ç½®çš„deploy-provider&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ³•ä¸€: åˆ©ç”¨traviså…§ç½®çš„deploy provider&quot;
      
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="ci" scheme="https://blog.nandiheath.com/categories/devops/ci/"/>
    
    
      <category term="travis" scheme="https://blog.nandiheath.com/tags/travis/"/>
    
      <category term="ci" scheme="https://blog.nandiheath.com/tags/ci/"/>
    
      <category term="npm" scheme="https://blog.nandiheath.com/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>gRPCåœ¨kubernetesçš„å°å•é¡Œ</title>
    <link href="https://blog.nandiheath.com/2019/02/26/grpc-in-kubernetes/"/>
    <id>https://blog.nandiheath.com/2019/02/26/grpc-in-kubernetes/</id>
    <published>2019-02-26T09:55:43.000Z</published>
    <updated>2019-09-18T09:13:44.714Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹ç·£æ¯éš”ä¸€æ®µæ™‚é–“deployå¾Œ<br>ç¸½æœ‰ä¸€éƒ¨ä»½podåœ¨é€£æ¥å…¶ä»–podçš„gRPCæ™‚æœƒå ±éŒ¯<br>ç™¼ç”Ÿæ©Ÿç‡æ¥µä½</p><p>ç¶“éä¸€å¤§å †çš„æ¸¬è©¦å¾Œå»åˆä¸èƒ½å¾©ç¾<br>åŒ…æ‹¬å„ç¨®DNS/k8sä¸Šçš„æ¸¬è©¦</p><p>ä½†æˆ‘æŸ¥çœ‹kube-proxyçš„logå¾Œ<br>ç›¸ä¿¡æ˜¯è·ŸgRPCå…§ç½®çš„dns cacheæ©Ÿåˆ¶æœ‰é—œä¿‚<br>å› ç‚ºæ¯æ¬¡ç‹€æ…‹ç™¼ç”Ÿæ™‚éƒ½è·Ÿkube-proxyçš„é‡å•Ÿæœ‰é—œä¿‚<br>å› ç‚ºæœªæ˜åŸå› å°è‡´kube-proxyé‡å•Ÿ &gt; é‡å•Ÿå¾Œä¸€äº›routingçš„æ”¹è®Š &gt;<br>æŸäº›podçš„internal ipæ”¹è®Šäº† &gt; gRPCçš„DNSä»èˆŠæŒ‡å‘èˆŠçš„pod ip &gt; é€£ä¸ä¸Š</p><p>ç”¨æ¯”è¼ƒæš´åŠ›çš„æ–¹æ³•å»è§£æ±º<br>å°±æ˜¯åˆ©ç”¨gRPCçš„DEADLINEæ©Ÿåˆ¶<br>å†åŠ ä¸Šè¨­å®šliveness probe<br>æ¯éš”ä¸€æ®µæ™‚é–“k8sæœƒè¨ªå•ä½ çš„ç‹€æ…‹<br>è‹¥æœæ˜¯é€£çºŒå¹¾æ¬¡éƒ½timeoutçš„è©±å°±æœƒæŠŠpodç æ‰é‡å•Ÿ</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> deadline = <span class="keyword">new</span> <span class="built_in">Date</span>().setSeconds(<span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds() + GRPC_TIMEOUT_SECONDS);</span><br><span class="line">gRPCClient.query(query, &#123; deadline &#125;, (err, res) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç•¶ç„¶ä¸Šé¢æ˜¯ä¸€å€‹å¾ˆå±éšªçš„æ–¹æ³•<br>è‹¥æœé€£ç·šç‹€æ…‹å¾ˆå·®å¯èƒ½æœƒä¸€ç›´é‡å•Ÿ<br>é€ æˆæœå‹™ä¸ç©©çš„æƒ…æ³<br>æ›´å¥½çš„åšæ³•æˆ–è€…æ˜¯åˆ©ç”¨ç¬¬ä¸‰æ–¹çš„service discovery<br>ä¾‹å¦‚Istioæˆ–è€…linkerdç­‰service mesh<br>æˆ–è€…å°‡ä¾†æœ‰æ™‚é–“å¯ä»¥å†ç ”ç©¶ä¸€ä¸‹â€¦</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://kubernetes.io/blog/2018/11/07/grpc-load-balancing-on-kubernetes-without-tears/" target="_blank" rel="noopener">https://kubernetes.io/blog/2018/11/07/grpc-load-balancing-on-kubernetes-without-tears/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;äº‹ç·£æ¯éš”ä¸€æ®µæ™‚é–“deployå¾Œ&lt;br&gt;ç¸½æœ‰ä¸€éƒ¨ä»½podåœ¨é€£æ¥å…¶ä»–podçš„gRPCæ™‚æœƒå ±éŒ¯&lt;br&gt;ç™¼ç”Ÿæ©Ÿç‡æ¥µä½&lt;/p&gt;
&lt;p&gt;ç¶“éä¸€å¤§å †çš„æ¸¬è©¦å¾Œå»åˆä¸èƒ½å¾©ç¾&lt;br&gt;åŒ…æ‹¬å„ç¨®DNS/k8sä¸Šçš„æ¸¬è©¦&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘æŸ¥çœ‹kube-proxyçš„logå¾Œ&lt;br&gt;ç›¸ä¿¡æ˜¯è·ŸgRPCå…§
      
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="dns" scheme="https://blog.nandiheath.com/tags/dns/"/>
    
      <category term="grpc" scheme="https://blog.nandiheath.com/tags/grpc/"/>
    
  </entry>
  
  <entry>
    <title>Interviewç„¶å¾ŒçŸ¥ä¸è¶³</title>
    <link href="https://blog.nandiheath.com/2019/02/25/interview/"/>
    <id>https://blog.nandiheath.com/2019/02/25/interview/</id>
    <published>2019-02-25T07:53:32.000Z</published>
    <updated>2019-09-18T09:13:44.714Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€é€£åƒèˆ‡äº†å…©é–“å…¬å¸çš„é¢è©¦ï¼Œé›–ç„¶é©šé©šéšªéšªçš„èµ°åˆ°æœ€å¾Œä¸€è¼ª<br>ä½†éç¨‹ä¸­æ·±æ·±æ„Ÿå—åˆ°è‡ªå·±çš„ä¸è¶³<br>å¸Œæœ›æœªä¾†å¯ä»¥æ”¹å–„(å§)</p><h2 id="Fast-Coder"><a href="#Fast-Coder" class="headerlink" title="Fast Coder"></a>Fast Coder</h2><p>ä¹‹å‰å°±ç®—åšstartupä¹Ÿå¥½<br>ç¾åœ¨åšçš„appä¹Ÿå¥½<br>å¾ˆå¤šæ™‚ä¾¯éƒ½è²ªåœ–å¿«æ·æ–¹ä¾¿<br>æ²’æœ‰ç”¨å¾ˆæ­£è¦çš„å¯«æ³•/æµç¨‹<br>ä¸€åˆ‡ä»¥çµæœç‚ºå…ˆ</p><p>æˆ‘æ·±ä¿¡å¾ˆå¤šé¦™æ¸¯çš„å…¬å¸ä¹Ÿæ˜¯é€™æ¨£<br>å°¤å…¶æ˜¯vendor<br>ä½†é€™ä¸æ˜¯ä¸€å€‹è—‰å£<br>TDD/BDDå°softwareçš„å¥½è™•é é å¤§æ–¼å¼Šè™•<br>è€Œä¸”ç¼ºä¹é•·é çš„è¨ˆåŠƒä¹Ÿçš„ç¢ºæ˜¯ä¸€å€‹å’ç—…<br>å¾—æ”¹</p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul><li>å…ˆæƒ³å¥½ï¼Œå¾Œå†è½æ‰‹åš</li><li>å¤šä¸€é»testing</li></ul><h2 id="è‹±æ–‡å·®"><a href="#è‹±æ–‡å·®" class="headerlink" title="è‹±æ–‡å·®"></a>è‹±æ–‡å·®</h2><p>umâ€¦<br>åªèƒ½èªªå¤šè½å¤šè¬›<br>ç•¢ç«Ÿé€™å…©å¹´æ™®é€šè©±çªé£›çŒ›é€²ä¹Ÿæ˜¯å› ç‚ºæ¯å¤©ç”¨æ™®é€šè©±è·Ÿå…§åœ°åŒäº‹æºé€šâ€¦</p><p>## </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€é€£åƒèˆ‡äº†å…©é–“å…¬å¸çš„é¢è©¦ï¼Œé›–ç„¶é©šé©šéšªéšªçš„èµ°åˆ°æœ€å¾Œä¸€è¼ª&lt;br&gt;ä½†éç¨‹ä¸­æ·±æ·±æ„Ÿå—åˆ°è‡ªå·±çš„ä¸è¶³&lt;br&gt;å¸Œæœ›æœªä¾†å¯ä»¥æ”¹å–„(å§)&lt;/p&gt;
&lt;h2 id=&quot;Fast-Coder&quot;&gt;&lt;a href=&quot;#Fast-Coder&quot; class=&quot;headerlink&quot; title=&quot;Fast 
      
    
    </summary>
    
      <category term="personal" scheme="https://blog.nandiheath.com/categories/personal/"/>
    
    
  </entry>
  
  <entry>
    <title>é¸æ“‡kubenetesçš„node type</title>
    <link href="https://blog.nandiheath.com/2019/02/21/choose-k8s-node-type-wisely/"/>
    <id>https://blog.nandiheath.com/2019/02/21/choose-k8s-node-type-wisely/</id>
    <published>2019-02-21T03:39:07.000Z</published>
    <updated>2019-09-18T09:13:44.709Z</updated>
    
    <content type="html"><![CDATA[<p>å…¬å¸çš„é›†ç¾¤ä¸€ç›´éƒ½åœ¨ç”¨t2.medium<br>åŸå› æ˜¯t2ç³»åˆ—ä¸­å¯ç´¯ç©çš„CPU creditéå¸¸å¯¦ç”¨<br>è©³æƒ…å¯åƒçœ‹ <a href="/2018/09/19/aws-t2-medium/" title="AWSä¸­t2.mediumçš„äºŒä¸‰äº‹">AWSä¸­t2.mediumçš„äºŒä¸‰äº‹</a><br>è€Œä¸”mediumçš„å…§å­˜(4G)ä¹Ÿå¤ è·‘ä¸€å®šæ•¸é‡çš„pod<br>æ¯”è¼ƒæ¯”ç›¸ç•¶ä¸éŒ¯</p><p>ä½†æœ€è¿‘åƒè€ƒäº†å…¶ä»–äººçš„åšæ³•<br>æŠŠnode typeå¾mediumè½‰æ›æˆxlargeä¹‹å¾Œ<br>nodeçš„æ•¸é‡å¤§æ¸›ä¹‹é¤˜ï¼Œåƒ¹æ ¼äº¦æœ‰ç›¸ç•¶çš„æ¸›å°‘<br>æ‰€ä»¥å¸Œæœ›åœ¨æ­¤åˆ†äº«ä¸€ä¸‹å¿ƒå¾—</p><h2 id="ç‚ºä»€éº¼t2-xlargeæœƒæ¯”t2-mediumå¥½"><a href="#ç‚ºä»€éº¼t2-xlargeæœƒæ¯”t2-mediumå¥½" class="headerlink" title="ç‚ºä»€éº¼t2.xlargeæœƒæ¯”t2.mediumå¥½"></a>ç‚ºä»€éº¼t2.xlargeæœƒæ¯”t2.mediumå¥½</h2><p>å¦‚æœå–®çœ‹åƒ¹éŒ¢çš„è©±<br>t2.xlargeçš„åƒ¹éŒ¢æ˜¯t2.mediumçš„4å€<br>ä½†åªæœ‰2å€æ–¼medium(4å€‹vCPU), cpu creditä¹Ÿæ²’æœ‰å»åˆ°4å€<br><img src="/images/aws-pricing.png" alt=""></p><p>é€™æ¨£çœ‹çš„è©±åªæœ‰å…§å­˜æ‰ç®—æ˜¯çœŸçš„4å€<br>é‚£ç‚ºä»€éº¼èªªxlargeæœƒæ¯”mediumåˆ©ç”¨ç‡æ›´å¥½å‘¢ï¼Ÿ</p><a id="more"></a><p>æˆ‘å€‘é¦–å…ˆè¦çœ‹ä¸€ä¸‹kubenetesæ¯å€‹nodeçš„ä¸€äº›è¨­å®š</p><h3 id="é è¨­æœå‹™"><a href="#é è¨­æœå‹™" class="headerlink" title="é è¨­æœå‹™"></a>é è¨­æœå‹™</h3><p>æ¯å€‹nodeæœ¬èº«éƒ½æœƒåœ¨å…¶ä¹‹ä¸Šè·‘ä¸€äº›é è¨­çš„æœå‹™<br>ä¾‹å¦‚kubeproxy<br><img src="/images/kube-proxy-resource.png" alt=""></p><p>å…¶è¦æ±‚çš„CPUå…¶å¯¦å·²ç¶“ä½”ç”¨äº†t2.mediumçš„1/20<br>æ¯é–‹ä¸€å°æ–°çš„nodeï¼Œå…¶ä¸­æœ€å°‘1/20çš„CPUå·²ç¶“è¢«ç³»çµ±ä½”ç”¨äº†<br>æ‰€ä»¥è¦åšscalingçš„é ç®—çš„è©±ï¼Œç•¶ä¸­çš„overheadä¹Ÿæ‡‰è¨ˆç®—åœ¨å…§</p><h3 id="Daemonset"><a href="#Daemonset" class="headerlink" title="Daemonset"></a>Daemonset</h3><p>å¦‚æœä½ çš„ç³»çµ±æœ‰åˆ©ç”¨åˆ°daemonsetçš„è©±<br>ä¹ŸæœƒçŸ¥é“æ¯å€‹nodeéƒ½è¦è·Ÿæ“šä½ çš„é…ç½®å»è·‘ä¸€äº›æœå‹™<br>ä¾‹å¦‚æˆ‘åœ¨é›†ç¾¤ä¸Šè·‘çš„ä¸€äº›filebeatè·Ÿlogrotate<br>é€™äº›æ±è¥¿éƒ½æœƒåœ¨æ¯å€‹nodeæ–°å¢ä¹‹æ™‚â€æ¶å»â€äº†ä¸€äº›CPU/å…§å­˜ç­‰çš„è³‡æº</p><p>æ‰€ä»¥æ¯å°nodeæ–°é…ç½®çš„æ™‚ä¾¯<br>ä¸€å®šçš„CPU/å…§å­˜éƒ½æœƒè¢«ä½”ç”¨<br>è€Œç•¶ä½ çš„æœå‹™å™¨é…ç½®é¸æ“‡æ¯”è¼ƒä½çš„è©±<br>å…¶CPU/å…§å­˜è¢«ä½”ç”¨çš„æ¯”é‡å°±ç›¸å°è¼ƒé«˜<br>ç°¡å–®ä¾†èªªå°±æ˜¯overheadæ¯”è¼ƒå¤§<br>å› ç‚ºä¸€å°t2.xlargeç›¸æ¯”èµ·å››å°t2.mediumçš„è©±<br>å…¶daemonset/é è¨­æœå‹™çš„æ¯”é‡å°±ç›´æ¥å°‘äº†3/4</p><p>è€Œä¸”å¯¦éš›æƒ…æ³å¾ˆå¤šæ™‚ä¾¯éƒ½æ˜¯memoryéœ€æ±‚é æ¯”cpuå¤§<br>cpuéœ€æ±‚é«˜çš„æœå‹™æˆ‘å€‘æ›´æ‡‰è©²é…ç½®ä¸€å°rç³»åˆ—çš„æ©Ÿå™¨å°ˆé–€è®“ä»–è·‘</p><h2 id="çµè«–"><a href="#çµè«–" class="headerlink" title="çµè«–"></a>çµè«–</h2><p>é‚£å¦‚æœxlargeæ¯”mediumå¥½çš„è©±<br>2xlargeæœƒå¦æ¯”xlargeæ›´å¥½ï¼Ÿ<br>æˆ‘æœƒèªªç†è«–ä¸Šæ˜¯<br>ä½†å¯¦éš›æƒ…æ³ä½ éœ€è¦åˆ†æï¼š<br>ä½ åˆ°åº•æœƒè·‘å¤šå°‘å€‹pod?<br>CPU/memoryæ¯”é‡æ˜¯å¤šå°‘ï¼Ÿ<br>å¤šå°‘daemon setåœ¨è·‘ï¼Ÿ<br>ç­‰ç­‰çš„å•é¡Œ<br>ç„¶å¾Œå†é¸æ“‡é©åˆä½ çš„é…ç½®</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…¬å¸çš„é›†ç¾¤ä¸€ç›´éƒ½åœ¨ç”¨t2.medium&lt;br&gt;åŸå› æ˜¯t2ç³»åˆ—ä¸­å¯ç´¯ç©çš„CPU creditéå¸¸å¯¦ç”¨&lt;br&gt;è©³æƒ…å¯åƒçœ‹ &lt;a href=&quot;/2018/09/19/aws-t2-medium/&quot; title=&quot;AWSä¸­t2.mediumçš„äºŒä¸‰äº‹&quot;&gt;AWSä¸­t2.mediumçš„äºŒä¸‰äº‹&lt;/a&gt;&lt;br&gt;è€Œä¸”mediumçš„å…§å­˜(4G)ä¹Ÿå¤ è·‘ä¸€å®šæ•¸é‡çš„pod&lt;br&gt;æ¯”è¼ƒæ¯”ç›¸ç•¶ä¸éŒ¯&lt;/p&gt;
&lt;p&gt;ä½†æœ€è¿‘åƒè€ƒäº†å…¶ä»–äººçš„åšæ³•&lt;br&gt;æŠŠnode typeå¾mediumè½‰æ›æˆxlargeä¹‹å¾Œ&lt;br&gt;nodeçš„æ•¸é‡å¤§æ¸›ä¹‹é¤˜ï¼Œåƒ¹æ ¼äº¦æœ‰ç›¸ç•¶çš„æ¸›å°‘&lt;br&gt;æ‰€ä»¥å¸Œæœ›åœ¨æ­¤åˆ†äº«ä¸€ä¸‹å¿ƒå¾—&lt;/p&gt;
&lt;h2 id=&quot;ç‚ºä»€éº¼t2-xlargeæœƒæ¯”t2-mediumå¥½&quot;&gt;&lt;a href=&quot;#ç‚ºä»€éº¼t2-xlargeæœƒæ¯”t2-mediumå¥½&quot; class=&quot;headerlink&quot; title=&quot;ç‚ºä»€éº¼t2.xlargeæœƒæ¯”t2.mediumå¥½&quot;&gt;&lt;/a&gt;ç‚ºä»€éº¼t2.xlargeæœƒæ¯”t2.mediumå¥½&lt;/h2&gt;&lt;p&gt;å¦‚æœå–®çœ‹åƒ¹éŒ¢çš„è©±&lt;br&gt;t2.xlargeçš„åƒ¹éŒ¢æ˜¯t2.mediumçš„4å€&lt;br&gt;ä½†åªæœ‰2å€æ–¼medium(4å€‹vCPU), cpu creditä¹Ÿæ²’æœ‰å»åˆ°4å€&lt;br&gt;&lt;img src=&quot;/images/aws-pricing.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;é€™æ¨£çœ‹çš„è©±åªæœ‰å…§å­˜æ‰ç®—æ˜¯çœŸçš„4å€&lt;br&gt;é‚£ç‚ºä»€éº¼èªªxlargeæœƒæ¯”mediumåˆ©ç”¨ç‡æ›´å¥½å‘¢ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="aws" scheme="https://blog.nandiheath.com/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>æŠŠblogç”±wordpressè½‰ç§»åˆ°hexo(ä¸‹)</title>
    <link href="https://blog.nandiheath.com/2019/01/02/wordpress-migrate-hexo-2/"/>
    <id>https://blog.nandiheath.com/2019/01/02/wordpress-migrate-hexo-2/</id>
    <published>2019-01-02T09:35:55.000Z</published>
    <updated>2019-09-18T09:13:44.717Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexoå°å¿ƒå¾—"><a href="#Hexoå°å¿ƒå¾—" class="headerlink" title="Hexoå°å¿ƒå¾—"></a>Hexoå°å¿ƒå¾—</h1><h2 id="å¾wordpressç›´æ¥å°å…¥"><a href="#å¾wordpressç›´æ¥å°å…¥" class="headerlink" title="å¾wordpressç›´æ¥å°å…¥"></a>å¾wordpressç›´æ¥å°å…¥</h2><p>å®‰è£plugin</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev hexo-migrator-wordpress</span><br></pre></td></tr></table></figure><p>æ³¨æ„é€™å€‹pluginä¸¦ä¸æœƒæŠŠåœ–ç‰‡è‡ªå‹•ä¸‹è¼‰<br>æˆ‘æ˜¯å¦å¤–å¯«äº†ä¸€å€‹scriptæŠŠåœ–ç‰‡éƒ½ä¸‹è¼‰ä¸¦åŠ å…¥åˆ°é …ç›®ç•¶ä¸­<br>å¥½ä¸€é»ç•¶ç„¶æ˜¯ä¸Šå‚³åˆ°ä¸€äº›æ°¸ä¹…çš„ç©ºé–“(å¦‚cloudinaryä¹‹é¡)</p><h2 id="SEOé…ç½®"><a href="#SEOé…ç½®" class="headerlink" title="SEOé…ç½®"></a>SEOé…ç½®</h2><p>åŠ å…¥sitemapåŠrss feed<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev hexo-generator-feed</span><br><span class="line">npm install --save-dev hexo-generator-sitemap</span><br></pre></td></tr></table></figure></p><p>ç•¶ç„¶æ¯å€‹postä½ ä¹Ÿæ‡‰è©²è¨­å®šä¸€å€‹å¥½çš„slugåŠç›¸é—œçš„tags</p><p>##ã€€è‡ªè¨‚theme</p><p>å®‰è£hexoæ™‚å°±å·²ç¶“é è¼‰äº†ä¸€å€‹themeæ–¼ç›®éŒ„<code>./themes/</code> ä¸­<br>æœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ä¿®æ”¹<br>æˆ–è€…å¯ä»¥ä½¿ç”¨å…¶ä»–äººæ‰€å¯«çš„theme</p><h2 id="æ‘˜è¦excerpt"><a href="#æ‘˜è¦excerpt" class="headerlink" title="æ‘˜è¦excerpt"></a>æ‘˜è¦excerpt</h2><p>åœ¨æ–‡ç« ä¸­åŠ å…¥ä»¥ä¸‹scriptæœƒè‡ªå‹•ç”Ÿæˆæ–‡ç« æ‘˜è¦</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- more --&gt;</span><br></pre></td></tr></table></figure><h2 id="Facebookç•™è¨€"><a href="#Facebookç•™è¨€" class="headerlink" title="Facebookç•™è¨€"></a>Facebookç•™è¨€</h2><p>å®‰è£plugin</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev hexo-fbcomments</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>_config.yaml</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Enable facebook comments</span><br><span class="line">fbcomments:</span><br><span class="line">  enabled: true</span><br><span class="line">  lang: zh_HK</span><br><span class="line">  appId: [facebook_app_id]</span><br><span class="line">  numPosts: 20</span><br></pre></td></tr></table></figure><h2 id="ç™¼ä½ˆåˆ°github-pages"><a href="#ç™¼ä½ˆåˆ°github-pages" class="headerlink" title="ç™¼ä½ˆåˆ°github pages"></a>ç™¼ä½ˆåˆ°github pages</h2><p>å…ˆå»ºç«‹ç›¸æ‡‰çš„github repoä¸¦æ–°å¢ä¸€å€‹orphan branch<br>å¯ä»¥çœ‹é€™è£¡ </p><p>ç„¶å¾Œå®‰è£plugin</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev hexo-deployer-git</span><br></pre></td></tr></table></figure><p>æ›´æ”¹<code>_config.yaml</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Deployment</span><br><span class="line"># Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:[username]/[reponame].git</span><br><span class="line">  branch: gh-pages</span><br><span class="line">  message:</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨commandç™¼ä½ˆ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo generate --deploy</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hexoå°å¿ƒå¾—&quot;&gt;&lt;a href=&quot;#Hexoå°å¿ƒå¾—&quot; class=&quot;headerlink&quot; title=&quot;Hexoå°å¿ƒå¾—&quot;&gt;&lt;/a&gt;Hexoå°å¿ƒå¾—&lt;/h1&gt;&lt;h2 id=&quot;å¾wordpressç›´æ¥å°å…¥&quot;&gt;&lt;a href=&quot;#å¾wordpressç›´æ¥å°å…¥&quot; cla
      
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="github-pages" scheme="https://blog.nandiheath.com/tags/github-pages/"/>
    
      <category term="hexo" scheme="https://blog.nandiheath.com/tags/hexo/"/>
    
      <category term="blog" scheme="https://blog.nandiheath.com/tags/blog/"/>
    
      <category term="wordpress" scheme="https://blog.nandiheath.com/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>æŠŠblogç”±wordpressè½‰ç§»åˆ°hexo(ä¸Š)</title>
    <link href="https://blog.nandiheath.com/2019/01/02/wordpress-migrate-hexo/"/>
    <id>https://blog.nandiheath.com/2019/01/02/wordpress-migrate-hexo/</id>
    <published>2019-01-02T08:55:28.000Z</published>
    <updated>2019-09-18T09:13:44.718Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠé€™å€‹blogç”±wordpressè½‰ç§»åˆ°github pagesä¸Š<br>åŒæ™‚äº¦åˆ©ç”¨äº†hexoä¾†ç”Ÿæˆéœæ…‹ç¶²ç«™<br>é‹è¡Œäº†ä¸€æ®µæ™‚é–“å¾Œååˆ†æ»¿æ„<br>æ‰€ä»¥åœ¨æ­¤ç™¼è¡¨ä¸€ä¸‹å¿ƒå¾—</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>Wordpressä½œç‚ºä¸–ç•Œä¸Šæœ€å¤šäººç”¨çš„blog/cmsç³»çµ±<br>ä½œç‚ºä¸€å€‹blogåœ¨åŠŸèƒ½ä¸Šç•¶ç„¶æ²’æœ‰ä»»ä½•ä¸è¶³<br>åŸºæœ¬çš„SEO/CMS/MigrateåŠŸèƒ½å·²ç¶“æœ‰è¶³å¤ çš„æ”¯æŒ<br>ä½†åœ¨æˆ‘è€Œè¨€ä»æœ‰éƒ¨åˆ†ä¸è¶³ä¹‹è™•</p><ul><li>ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶</li><li>å®Œæ•´å‚™ä»½ä¸ç®—ç°¡å–®(å°¤å…¶æ˜¯åœ–ç‰‡)</li><li>éœ€è¦æ•¸æ“šåº«</li><li>å®¹æ˜“æˆç‚ºæ”»æ“Šçš„ç›®æ¨™</li></ul><p>å› ç‚ºæˆ‘ç¶“å¸¸æœƒæŠŠæ±è¥¿æ¬ä¾†æ¬å»<br>e.g. ç”±è‡ªå·±å®¶çš„æœå‹™å™¨ &gt; Digital Ocean &gt; GKE &gt; GCP<br>æ¯æ¬¡éœ€è¦æ¬blogçš„æ™‚ä¾¯å°±è¦æ‰¾å€‹plugin æŠŠblogçš„å…§å®¹å°å‡ºå†å°å…¥<br>é‚„è¦æ“”å¿ƒåœ–ç‰‡æ²’æ¬é·æˆåŠŸ (æœ‰å¯èƒ½exportå‡ºä¾†çš„blogåªæŠŠåœ–ç‰‡å°å‡ºæˆé€£çµ)<br>è€Œä¸”è‡ªå·±æ¶çš„æ•¸æ“šåº«è¦å®šæœŸåšå‚™ä»½ç­‰ç­‰â€¦</p><a id="more"></a><h2 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h2><p>èªªåˆ°Hexoä¸å¾—ä¸æä¸€ä¸‹static website<br>åœ¨äº’è¯ç¶²åˆæœŸå¾ˆå¤šäººéƒ½æ˜¯å¯«éœæ…‹ç¶²ç«™<br>å°±æ˜¯æ²’æœ‰æ•¸æ“šåº«<br>æ‰€æœ‰é é¢éƒ½æ˜¯ä¸€é é çš„html<br>éå¸¸ç°¡å–®<br>æœ€è¿‘ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯å¤è€ç•¶æ™‚èˆˆ<br>ç¹¼single page applicationä¹‹å¾Œstatic websiteä¹Ÿé‡æ–°é€²å…¥å¤§çœ¾çš„è¦–ç·šå…§<br>çš„ç¢ºstatic websiteä¹Ÿæ˜¯æœ‰å…¶å„ªé»çš„</p><ul><li>æœ€ç°¡å–®çš„æ¶æ§‹</li><li>ç„¡èˆ‡å€«æ¯”çš„é€Ÿåº¦</li></ul><p>é›–ç„¶blogçš„è©±é€Ÿåº¦ä¸éœ€è¦è€ƒæ…®â€¦</p><h2 id="Git-ç„¶å¾ŒGithub-pages"><a href="#Git-ç„¶å¾ŒGithub-pages" class="headerlink" title="Git, ç„¶å¾ŒGithub pages"></a>Git, ç„¶å¾ŒGithub pages</h2><p>æˆ–è¨±ä½ æœƒå•<br>static website generatoræ¶æ§‹ç°¡å–®ï¼Œæ˜¯æ²’æœ‰æ•¸æ“šåº«<br>ç„¶å¾Œå‘¢ï¼Ÿæˆ‘ä»ç„¶è¦hostè¦å‚™ä»½å§ï¼Ÿ</p><p>é€™å€‹æ™‚ä¾¯å°±å¯ä»¥çœ‹ä¸€ä¸‹Github pagesäº†<br>github æœ‰ä¸€å€‹æœå‹™å°±æ˜¯å¯ä»¥hostä¸€äº›ç°¡å–®çš„éœæ…‹ç¶²é <br>æ²’éŒ¯ï¼Œçµåˆhexoé€™é¡çš„éœæ…‹ç¶²é ç”Ÿæˆå™¨<br>ç„¡æ•µçš„çµ„åˆå°±èª•ç”Ÿäº†ï¼</p><p>éå¸¸ç°¡å–®çš„Stack:<br>ä¸€å€‹gitçš„hexoé …ç›®(å¯ä»¥æ˜¯gitlab/githubæˆ–è€…è‡ªå·±host)<br>ä¸€å€‹githubé …ç›®(ç”¨æ–¼ç™¼ä½ˆç¶²ç«™)<br>ä¸€å€‹åŸŸå</p><p>ä¸€å€‹ä¸ç”¨æ“”å¿ƒå‚™ä»½çš„Blogå°±é€™æ¨£ç”Ÿæˆäº†ï¼</p><a href="/2019/01/02/wordpress-migrate-hexo-2/" title="æŠŠblogç”±wordpressè½‰ç§»åˆ°hexo(ä¸‹)">æŠŠblogç”±wordpressè½‰ç§»åˆ°hexo(ä¸‹)</a><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://pages.github.com/" target="_blank" rel="noopener">https://pages.github.com/</a></li><li><a href="https://hexo.io/" target="_blank" rel="noopener">https://hexo.io/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æŠŠé€™å€‹blogç”±wordpressè½‰ç§»åˆ°github pagesä¸Š&lt;br&gt;åŒæ™‚äº¦åˆ©ç”¨äº†hexoä¾†ç”Ÿæˆéœæ…‹ç¶²ç«™&lt;br&gt;é‹è¡Œäº†ä¸€æ®µæ™‚é–“å¾Œååˆ†æ»¿æ„&lt;br&gt;æ‰€ä»¥åœ¨æ­¤ç™¼è¡¨ä¸€ä¸‹å¿ƒå¾—&lt;/p&gt;
&lt;h2 id=&quot;åŸå› &quot;&gt;&lt;a href=&quot;#åŸå› &quot; class=&quot;headerlink&quot; title=&quot;åŸå› &quot;&gt;&lt;/a&gt;åŸå› &lt;/h2&gt;&lt;p&gt;Wordpressä½œç‚ºä¸–ç•Œä¸Šæœ€å¤šäººç”¨çš„blog/cmsç³»çµ±&lt;br&gt;ä½œç‚ºä¸€å€‹blogåœ¨åŠŸèƒ½ä¸Šç•¶ç„¶æ²’æœ‰ä»»ä½•ä¸è¶³&lt;br&gt;åŸºæœ¬çš„SEO/CMS/MigrateåŠŸèƒ½å·²ç¶“æœ‰è¶³å¤ çš„æ”¯æŒ&lt;br&gt;ä½†åœ¨æˆ‘è€Œè¨€ä»æœ‰éƒ¨åˆ†ä¸è¶³ä¹‹è™•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶&lt;/li&gt;
&lt;li&gt;å®Œæ•´å‚™ä»½ä¸ç®—ç°¡å–®(å°¤å…¶æ˜¯åœ–ç‰‡)&lt;/li&gt;
&lt;li&gt;éœ€è¦æ•¸æ“šåº«&lt;/li&gt;
&lt;li&gt;å®¹æ˜“æˆç‚ºæ”»æ“Šçš„ç›®æ¨™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ç‚ºæˆ‘ç¶“å¸¸æœƒæŠŠæ±è¥¿æ¬ä¾†æ¬å»&lt;br&gt;e.g. ç”±è‡ªå·±å®¶çš„æœå‹™å™¨ &amp;gt; Digital Ocean &amp;gt; GKE &amp;gt; GCP&lt;br&gt;æ¯æ¬¡éœ€è¦æ¬blogçš„æ™‚ä¾¯å°±è¦æ‰¾å€‹plugin æŠŠblogçš„å…§å®¹å°å‡ºå†å°å…¥&lt;br&gt;é‚„è¦æ“”å¿ƒåœ–ç‰‡æ²’æ¬é·æˆåŠŸ (æœ‰å¯èƒ½exportå‡ºä¾†çš„blogåªæŠŠåœ–ç‰‡å°å‡ºæˆé€£çµ)&lt;br&gt;è€Œä¸”è‡ªå·±æ¶çš„æ•¸æ“šåº«è¦å®šæœŸåšå‚™ä»½ç­‰ç­‰â€¦&lt;/p&gt;
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="github-pages" scheme="https://blog.nandiheath.com/tags/github-pages/"/>
    
      <category term="hexo" scheme="https://blog.nandiheath.com/tags/hexo/"/>
    
      <category term="blog" scheme="https://blog.nandiheath.com/tags/blog/"/>
    
      <category term="wordpress" scheme="https://blog.nandiheath.com/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>æ¸…é™¤dockerä¸»æ©Ÿä¸Šçš„åƒåœ¾</title>
    <link href="https://blog.nandiheath.com/2018/12/13/docker-auto-cleanup/"/>
    <id>https://blog.nandiheath.com/2018/12/13/docker-auto-cleanup/</id>
    <published>2018-12-13T04:23:35.000Z</published>
    <updated>2019-09-18T09:13:44.710Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœä½ åœ¨æœ¬æ©Ÿä¸Šæœ‰docker buildï¼Œæˆ–è€…ä½ çš„CIæœ‰ç”¨åˆ°docker buildçš„æ™‚ä¾¯<br>æ¯éä¸€æ®µæ™‚é–“å°±æœƒç™¼ç¾ä½”ç”¨çš„ç©ºé–“æœƒå¤§å¾—å¾ˆèª‡å¼µ<br>åŸå› æ˜¯docker buildçš„æ™‚ä¾¯æœƒä¸‹è¼‰å„ç¨®çš„base imageï¼Œæ›´ç”šè€…æœƒå»ºç«‹å„æ¨£çš„fs layer<br>è€Œä¸”å»ºç«‹äº†çš„image/fs layeræ˜¯ä¸æœƒä¸»å‹•å»åˆªæ‰çš„<br>æ‰€ä»¥å°±éœ€è¦è¨­ç«‹ä¸€äº›cronjob å»å®šæœŸæŠŠæ²’ç”¨/èˆŠçš„æ±è¥¿åˆªæ‰å»é¨°å‡ºæ›´å¤šçš„ç©ºé–“</p><a id="more"></a><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>linuxçš„è©±åªéœ€è¦åœ¨<code>crontab</code>ä¸­è¨­å®š<code>docker system prune</code>å°±å¯ä»¥äº†<br>é€™å€‹æŒ‡ä»¤æœƒç§»é™¤</p><ol><li>æ‰€æœ‰æ²’æœ‰è¢«å…¶ä»–imageå¼•ç”¨çš„image (dangling images)</li><li>æ‰€æœ‰å·²åœæ­¢çš„container</li><li>æ‰€æœ‰æœªè¢«æœ€å°‘ä¸€å€‹é‹è¡Œä¸­çš„containerä½¿ç”¨çš„network</li><li>æ‰€æœ‰build cache</li></ol><p>å¦‚æœæƒ³å¾¹åº•ä¸€é»çš„è©±å¯ä»¥ä½¿ç”¨<code>docker system prune -a</code><br>é€™å€‹æŒ‡ä»¤æœƒæŠŠæ‰€æœ‰æœªç”¨çš„imageéƒ½åˆªæ‰<br>æ‰€ä»¥å¦‚æœä¸€äº›image æœ‰å¼•ç”¨åˆ°å…¶ä»–imageæ™‚ï¼Œç•¶ä½ å†buildçš„æ™‚ä¾¯å°±éœ€è¦é‡æ–°ä¸‹è¼‰äº†</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0 0 * * * /usr/bin/docker system prune -f</span><br></pre></td></tr></table></figure><p>é€™æ¨£æ¯å¤©é›¶æ™¨é›¶æ™‚(UTCï¼Œè©³ç´°è«‹æª¢æŸ¥æœå‹™å™¨è¨­å®š)å°±æœƒé‹è¡Œsystem pruneäº†<br>ä½†å› ç‚ºé€™å€‹å‹•ä½œç¬¬ä¸€æ¬¡é‹è¡Œæ™‚æœƒéœ€æ™‚å¾ˆä¹…ï¼Œæ‰€ä»¥åƒè¬è«‹æŒ‘é¸æœå‹™å™¨ç©ºé–’çš„æ™‚é–“æ‰åŸ·è¡Œ</p><h3 id="åŸ·è¡Œsystem-pruneæ™‚ç•¶æ©Ÿ"><a href="#åŸ·è¡Œsystem-pruneæ™‚ç•¶æ©Ÿ" class="headerlink" title="åŸ·è¡Œsystem pruneæ™‚ç•¶æ©Ÿ"></a>åŸ·è¡Œsystem pruneæ™‚ç•¶æ©Ÿ</h3><p>æœ‰æ™‚ä¾¯é‹è¡Œimage prune æ™‚æœƒå°è‡´docker æ•´å€‹æ›æ‰ï¼Œéœ€è¦é‡å•Ÿä¸€ä¸‹dockeræ‰èƒ½å†æ¬¡åŸ·è¡Œps/infoç­‰å‘½ä»¤<br>æ‰€ä»¥å¯ä»¥åˆ©ç”¨å…¶ä»–å‘½ä»¤å…ˆæŠŠimageçš„æ•¸é‡æ¸›å°‘ä¸€ä¸‹<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker rmi $(docker images --filter <span class="string">"dangling=true"</span> -q --no-trunc)</span><br></pre></td></tr></table></figure></p><p><a href="https://stackoverflow.com/questions/32723111/how-to-remove-old-and-unused-docker-images" target="_blank" rel="noopener">https://stackoverflow.com/questions/32723111/how-to-remove-old-and-unused-docker-images</a></p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="https://nickjanetakis.com/blog/docker-tip-32-automatically-clean-up-after-docker-daily" target="_blank" rel="noopener">https://nickjanetakis.com/blog/docker-tip-32-automatically-clean-up-after-docker-daily</a></li><li><a href="https://docs.docker.com/engine/reference/commandline/system_prune/#examples" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/system_prune/#examples</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœä½ åœ¨æœ¬æ©Ÿä¸Šæœ‰docker buildï¼Œæˆ–è€…ä½ çš„CIæœ‰ç”¨åˆ°docker buildçš„æ™‚ä¾¯&lt;br&gt;æ¯éä¸€æ®µæ™‚é–“å°±æœƒç™¼ç¾ä½”ç”¨çš„ç©ºé–“æœƒå¤§å¾—å¾ˆèª‡å¼µ&lt;br&gt;åŸå› æ˜¯docker buildçš„æ™‚ä¾¯æœƒä¸‹è¼‰å„ç¨®çš„base imageï¼Œæ›´ç”šè€…æœƒå»ºç«‹å„æ¨£çš„fs layer&lt;br&gt;è€Œä¸”å»ºç«‹äº†çš„image/fs layeræ˜¯ä¸æœƒä¸»å‹•å»åˆªæ‰çš„&lt;br&gt;æ‰€ä»¥å°±éœ€è¦è¨­ç«‹ä¸€äº›cronjob å»å®šæœŸæŠŠæ²’ç”¨/èˆŠçš„æ±è¥¿åˆªæ‰å»é¨°å‡ºæ›´å¤šçš„ç©ºé–“&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
    
      <category term="docker" scheme="https://blog.nandiheath.com/tags/docker/"/>
    
      <category term="system" scheme="https://blog.nandiheath.com/tags/system/"/>
    
      <category term="prune" scheme="https://blog.nandiheath.com/tags/prune/"/>
    
      <category term="build" scheme="https://blog.nandiheath.com/tags/build/"/>
    
  </entry>
  
  <entry>
    <title>ç•¶elasticsearchç¡¬ç¢Ÿæ»¿äº†</title>
    <link href="https://blog.nandiheath.com/2018/11/02/elasticsearch-disk-full/"/>
    <id>https://blog.nandiheath.com/2018/11/02/elasticsearch-disk-full/</id>
    <published>2018-11-02T08:51:17.000Z</published>
    <updated>2019-09-18T09:13:44.713Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸å°å¿ƒæŠŠdevå ´gRPCçš„debug logæ‰“é–‹äº†ï¼Œå°è‡´æ¯å¤©ç”¢ç”Ÿäº†å·®ä¸å¤š800è¬æ¢event<br>æŠŠæœ¬ä¾†å°±å‰©ä¸äº†å¤šå°‘çš„ç©ºé–“ç›´æ¥å¡çˆ†äº†ï¼Œç¢°å·§prometheusè·Ÿlogstashåœ¨åŒä¸€å€‹ç¯€é»ä¸Š<br>prometheusä¸å¹¸åœ°æ›æ‰äº†å°è‡´é€£è¨Šæ¯ä¹Ÿæ²’æ”¶åˆ°<br>éäº†å…©ä¸‰å¤©æ‰ç™¼è¦ºæ•¸æ“šæ²’äº†æ‰ç™¼ç¾å‡ºäº‹</p><p>æœ€å¾Œè¦æäº†å…©å¤©æ‰æŠŠæ•¸æ“šå›å¾©<br>å¹¸é‹çš„æ˜¯é–‹å§‹æ™‚å°±å·²ç¶“è¨­ç½®äº†ä¸€äº›æ©Ÿåˆ¶å»é˜²éŒ¯<br>å› æ­¤é€™æ¬¡æ‰æ²’æœ‰ç™¼å±•æˆç‚ºç½é›£æ€§çš„äº‹ä»¶<br>å°±å¯«äº†ä»¥ä¸‹çš„ä¸€äº›åˆ†äº«</p><a id="more"></a><hr><h3 id="1-log-shipperå¾ˆé‡è¦"><a href="#1-log-shipperå¾ˆé‡è¦" class="headerlink" title="1. log shipperå¾ˆé‡è¦"></a>1. log shipperå¾ˆé‡è¦</h3><p>åœ¨ä¸€é–‹å§‹ä½¿ç”¨ELK stackæ™‚ä¹Ÿæœ‰è€ƒæ…®éç¶“TCPç›´æ¥ç”±loggerç¶“TCPç›´æ¥å‚³çµ¦logstash/es<br>ä½†è€ƒæ…®åˆ°å¤šå€‹å› ç´ å¦‚ç¶²çµ¡/æœå‹™å™¨ç©©å®šæ€§ç­‰å°±æ±ºå®šç”¨filebeat<br>filebeatçš„å¥½è™•æ˜¯ä½ ç›´æ¥æŠŠæ—¥èªŒæ‰“åˆ°fileè£¡å»ï¼Œç„¶å¾Œå†åŠ ä¸€å€‹logrotateå»è¨­å®šè¼ªæ›¿<br><strong>é€™é»å¾ˆé‡è¦ï¼Œä¸ç„¶æ—¥èªŒçš„æª”æ¡ˆåªæœƒå¢ä¸æœƒæ¸›ï¼Œå„²å­˜ç©ºé–“æœƒè®Šæˆå¦ä¸€å€‹å•é¡Œ</strong><br>ç„¶å¾Œç¶“filebeatä¸Šå‚³åˆ°logstash/es</p><p>å¦‚æœä½ ä½¿ç”¨network loggingçš„è©±<br>åªè¦logstash/es å ±éŒ¯ï¼Œé‚£éº¼ä½ é‚£æ®µæ™‚é–“çš„logå°±çœŸçš„è®Šæ²’æœ‰äº†(é™¤éä½ æœƒé‡å¯«ï¼Œä½†ä¹Ÿå› æ­¤æœ‰æ›´å¤šçš„æ±è¥¿è¦å…¼é¡§)<br>è€Œç”¨filebeatçš„è©±ä½ é‚„æœ‰ä¸€æ®µæ™‚é–“å¯ä»¥æ’éŒ¯ä¿®å¾©(logrotate ä¸€èˆ¬å°±7-10æ—¥)<br>é€™æ­£æ­£çµ¦äº†æˆ‘æ™‚é–“å»æŠŠé‚£äº›æ²’æœ‰ä¸Šå‚³çš„log é‡æ–°ä¸Šè¼‰â€¦</p><h3 id="2-non-prodçš„logæœ€å¥½ç”¨curatoræ¯æ—¥æ¸…æ‰"><a href="#2-non-prodçš„logæœ€å¥½ç”¨curatoræ¯æ—¥æ¸…æ‰" class="headerlink" title="2. non-prodçš„logæœ€å¥½ç”¨curatoræ¯æ—¥æ¸…æ‰"></a>2. non-prodçš„logæœ€å¥½ç”¨curatoræ¯æ—¥æ¸…æ‰</h3><p>è‹¥éè¦æ¸¬è©¦ï¼Œé‚£éº¼éproductionå ´çš„æ•¸æ“šæ‡‰è©²è¦åŠæ—©åˆªæ‰<br>ä¸ç„¶indexæ•¸é‡åªæœƒè¶Šä¾†è¶Šå¤šâ€¦</p><h3 id="3-match-timestampæ˜¯å¾ˆé‡è¦çš„"><a href="#3-match-timestampæ˜¯å¾ˆé‡è¦çš„" class="headerlink" title="3. match timestampæ˜¯å¾ˆé‡è¦çš„"></a>3. match timestampæ˜¯å¾ˆé‡è¦çš„</h3><p>ESæœ¬èº«çš„è¨­å®šæ˜¯ä½ ä»€éº¼æ™‚ä¾¯ä¸Šå‚³eventçµ¦ä»–ï¼Œä»–å°±æœƒé è¨­æŠŠè©²eventçš„æ™‚é–“è¨­å®šç‚ºè©²æ™‚é–“<br>å¯ä»¥é€élogstashæŠŠlogè£¡é¢çš„æ™‚é–“è¦†è“‹æ‰æœ¬ä¾†çš„timestamp<br>é€™å€‹å¥½è™•æ˜¯eventåœ¨esçš„timestampè®Šå¾—æ›´æœ‰æ„ç¾©(ç”±ä¸Šå‚³æ™‚é–“è®Šç‚ºç™¼ç”Ÿæ™‚é–“)<br>æ›´å¤§çš„å¥½è™•æ˜¯å¦‚æœä½ é«˜è² è¼‰/é‡æ–°ä¸Šå‚³æ™‚æ™‚é–“è³‡è¨Šå°±ä¸æœƒä¸Ÿå¤±</p><h3 id="4-ESæœ¬èº«çš„ç¡¬ç¢Ÿé˜²çˆ†æ©Ÿåˆ¶"><a href="#4-ESæœ¬èº«çš„ç¡¬ç¢Ÿé˜²çˆ†æ©Ÿåˆ¶" class="headerlink" title="4. ESæœ¬èº«çš„ç¡¬ç¢Ÿé˜²çˆ†æ©Ÿåˆ¶"></a>4. ESæœ¬èº«çš„ç¡¬ç¢Ÿé˜²çˆ†æ©Ÿåˆ¶</h3><p>è©³ç´°å¯çœ‹é€™è£¡<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/disk-allocator.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.x/disk-allocator.html</a><br>ç°¡å–®ä¾†èªªå°±æ˜¯ESæœƒæŠŠç¡¬ç¢Ÿå¿«æ»¿åˆ†åˆ¥ä¸‰å€‹éšæ®µ</p><p><code>cluster.routing.allocation.disk.watermark.low</code></p><ul><li>é è¨­85% ç•¶æŸå€‹ç¯€é»è¶…éé€™å€‹é™é¡å¾ŒESæœƒåœæ­¢åˆ†é…shardsåˆ°å…¶ä¹‹ä¸Š</li></ul><p><code>cluster.routing.allocation.disk.watermark.high</code></p><ul><li>é è¨­90% ç•¶æŸå€‹ç¯€é»è¶…éé€™å€‹é™é¡å¾ŒESæœƒå˜—è©¦æŠŠè©²ç¯€é»çš„shardsåˆ†é…åˆ°å…¶ä»–ç¯€é»ä¸Š</li></ul><p><code>cluster.routing.allocation.disk.watermark.flood_stage</code></p><ul><li><p>é è¨­95% ç•¶æŸå€‹ç¯€é»è¶…éé€™å€‹é™é¡å¾ŒESæœƒæŠŠè©²ç¯€é»çš„æ‰€æœ‰indexéƒ½åŠ ä¸€å€‹flag <code>index.blocks.read_only_allow_delete</code></p><p>æ„å‘³è‘—é‚£äº›indexè®Šæˆå”¯è®€ï¼Œé˜²æ­¢ç¡¬ç¢ŸçœŸçš„çˆ†æ»¿</p></li></ul><hr><p>æœ€å¾Œå›å¾©æ•¸æ“šæ™‚å¡æœ€ä¹…å°±æ˜¯<code>index.blocks.read_only_allow_delete</code>é€™å€‹æ©Ÿåˆ¶<br>å› ç‚ºç•¶æˆ‘æŠŠå…©å€‹data nodeçš„ç¡¬ç¢Ÿç©ºé–“éƒ½å¢åŠ äº†ä¹‹å¾Œ<br>logstash/filebeatéƒ½å¡ä½ä¸å‹•ï¼Œesä¹Ÿæ²’æœ‰çœ‹åˆ°æœ‰æ–°æ•¸æ“šé€²ä¾†<br>æäº†å¾ˆä¹…æ‰ç™¼ç¾é€™å€‹æ©Ÿåˆ¶</p><p>è€Œè¦è§£æ±ºä¹Ÿå¾ˆè§£å–®çš„ï¼Œåªéœ€è¦æ›´æ–°æ¯å€‹indexçš„è¨­å®šï¼ŒæŠŠé€™æflagè¨­æˆnullå°±å¯ä»¥äº†<br>(ç•¶ç„¶æœ€å¥½å°±æ˜¯é€å€‹indexå»è§£é–)</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># reset all the read only flag for all indices</span></span><br><span class="line">PUT /_all/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index.blocks.read\_only\_allow_delete"</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸å°å¿ƒæŠŠdevå ´gRPCçš„debug logæ‰“é–‹äº†ï¼Œå°è‡´æ¯å¤©ç”¢ç”Ÿäº†å·®ä¸å¤š800è¬æ¢event&lt;br&gt;æŠŠæœ¬ä¾†å°±å‰©ä¸äº†å¤šå°‘çš„ç©ºé–“ç›´æ¥å¡çˆ†äº†ï¼Œç¢°å·§prometheusè·Ÿlogstashåœ¨åŒä¸€å€‹ç¯€é»ä¸Š&lt;br&gt;prometheusä¸å¹¸åœ°æ›æ‰äº†å°è‡´é€£è¨Šæ¯ä¹Ÿæ²’æ”¶åˆ°&lt;br&gt;éäº†å…©ä¸‰å¤©æ‰ç™¼è¦ºæ•¸æ“šæ²’äº†æ‰ç™¼ç¾å‡ºäº‹&lt;/p&gt;
&lt;p&gt;æœ€å¾Œè¦æäº†å…©å¤©æ‰æŠŠæ•¸æ“šå›å¾©&lt;br&gt;å¹¸é‹çš„æ˜¯é–‹å§‹æ™‚å°±å·²ç¶“è¨­ç½®äº†ä¸€äº›æ©Ÿåˆ¶å»é˜²éŒ¯&lt;br&gt;å› æ­¤é€™æ¬¡æ‰æ²’æœ‰ç™¼å±•æˆç‚ºç½é›£æ€§çš„äº‹ä»¶&lt;br&gt;å°±å¯«äº†ä»¥ä¸‹çš„ä¸€äº›åˆ†äº«&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="aws" scheme="https://blog.nandiheath.com/tags/aws/"/>
    
      <category term="elasticsearch" scheme="https://blog.nandiheath.com/tags/elasticsearch/"/>
    
      <category term="elk" scheme="https://blog.nandiheath.com/tags/elk/"/>
    
      <category term="filebeat" scheme="https://blog.nandiheath.com/tags/filebeat/"/>
    
      <category term="k8s" scheme="https://blog.nandiheath.com/tags/k8s/"/>
    
      <category term="logstash" scheme="https://blog.nandiheath.com/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ä¸åŒçš„private keyå»å­˜å–git</title>
    <link href="https://blog.nandiheath.com/2018/10/04/different-private-key-for-git/"/>
    <id>https://blog.nandiheath.com/2018/10/04/different-private-key-for-git/</id>
    <published>2018-10-04T05:25:06.000Z</published>
    <updated>2019-09-18T09:13:44.710Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœåŒä¸€å°é›»è…¦éœ€è¦å­˜å–ä¸åŒçš„gité …ç›®ï¼Œä½†ç”±æ–¼èº«ä»½çš„ä¸åŒä½ æœƒæœ‰å¤šéä¸€å€‹private key<br>SSHæ™‚å¾ˆç°¡å–®çš„ç”¨ -i å°±å¯ä»¥äº†<br>ä½†gitå°±ç¨ç‚ºè¤‡é›œ  </p><a id="more"></a><h2 id="æ–¹æ³•ä¸€-åˆ©ç”¨environment-variableå»æŒ‡å®šSSHç”¨çš„private-key"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨environment-variableå»æŒ‡å®šSSHç”¨çš„private-key" class="headerlink" title="æ–¹æ³•ä¸€: åˆ©ç”¨environment variableå»æŒ‡å®šSSHç”¨çš„private key"></a>æ–¹æ³•ä¸€: åˆ©ç”¨environment variableå»æŒ‡å®šSSHç”¨çš„private key</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GIT_SSH_COMMAND=<span class="string">"ssh -i ~/.ssh/id_rsa_example"</span> git <span class="built_in">clone</span> example.com/repo.git</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒ-æ¨è–¦-åˆ©ç”¨ssh-config"><a href="#æ–¹æ³•äºŒ-æ¨è–¦-åˆ©ç”¨ssh-config" class="headerlink" title="æ–¹æ³•äºŒ(æ¨è–¦): åˆ©ç”¨ssh config"></a>æ–¹æ³•äºŒ(æ¨è–¦): åˆ©ç”¨ssh config</h2><p>é¦–å…ˆä½ éœ€è¦æ–°å¢ä¸€å€‹æª”æ¡ˆ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># permissionéœ€ç‚º600</span></span><br><span class="line">touch ~/.ssh/config</span><br></pre></td></tr></table></figure><p>é€™å€‹æª”æ¡ˆè®“ä½ çš„SSHçŸ¥é“ä¸åŒçš„host nameå°æ‡‰çš„è¨­ç½®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Company Account</span></span><br><span class="line">host gitlab.com-company</span><br><span class="line">        HostName gitlab.com</span><br><span class="line">        User git</span><br><span class="line">        IdentityFile ~/.ssh/my_company_id_rsa</span><br><span class="line"></span><br><span class="line"><span class="comment"># Personal Account</span></span><br><span class="line">host gitlab.com-personal</span><br><span class="line">        HostName gitlab.com</span><br><span class="line">        User git</span><br><span class="line">        IdentityFile ~/.ssh/my_personal_id_rsa</span><br></pre></td></tr></table></figure><p>ä¹‹å¾Œå°±å¯ä»¥ç›´æ¥ç”¨ä¸åŒçš„private keyå»å­˜å–ä¸åŒçš„repoäº†<br>ä½†è¦æ³¨æ„æ˜¯é€™é‚Šç”¨åˆ°çš„æ˜¯ä½ å‰›å‰›è¨­å®šçš„<code>gitlab.com-company</code>,è€Œä¸æ˜¯<code>gitlab.com</code><br>å¦å‰‡åªæœƒç”¨é»˜èªçš„private key(å¦‚~/.ssh/id_rsa)</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¦ä¾‹</span></span><br><span class="line"><span class="comment"># å­˜å–å…¬å¸repo</span></span><br><span class="line">git <span class="built_in">clone</span> git@gitlab.com-company:company-repo/a-project.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å–ç§äººrepo</span></span><br><span class="line">git <span class="built_in">clone</span> git@gitlab.com-personal:my-repo/another-project.git</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœåŒä¸€å°é›»è…¦éœ€è¦å­˜å–ä¸åŒçš„gité …ç›®ï¼Œä½†ç”±æ–¼èº«ä»½çš„ä¸åŒä½ æœƒæœ‰å¤šéä¸€å€‹private key&lt;br&gt;SSHæ™‚å¾ˆç°¡å–®çš„ç”¨ -i å°±å¯ä»¥äº†&lt;br&gt;ä½†gitå°±ç¨ç‚ºè¤‡é›œ  &lt;/p&gt;
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="git" scheme="https://blog.nandiheath.com/tags/git/"/>
    
      <category term="key" scheme="https://blog.nandiheath.com/tags/key/"/>
    
      <category term="ssh" scheme="https://blog.nandiheath.com/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>ES6 destructuring åƒæ•¸</title>
    <link href="https://blog.nandiheath.com/2018/10/02/es6-destructuring/"/>
    <id>https://blog.nandiheath.com/2018/10/02/es6-destructuring/</id>
    <published>2018-10-02T10:54:43.000Z</published>
    <updated>2019-09-18T09:13:44.713Z</updated>
    
    <content type="html"><![CDATA[<p>Destructuring (è§£æ§‹è³¦å€¼)æ˜¯es6ä¸­å¾ˆå¸¸ç”¨çš„èªæ³•<br>ç”¨è™•æ˜¯ä¸ç”¨é»(.)ä¾†é»(.)å»ï¼Œç›´æ¥æŠŠObjectä¸­çš„å€¼åŒ–ç‚ºå¯¦éš›è®Šé‡ä¾†ä½¿ç”¨</p><hr><p>ç°¡å–®çš„ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> somdata = &#123;</span><br><span class="line">  id: <span class="string">"1"</span>,</span><br><span class="line">  user_name: <span class="string">"Nandi"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èˆŠå¼å¯«æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user\_name = data.user\_name;</span><br><span class="line"><span class="keyword">var</span> id = data.id;</span><br><span class="line"></span><br><span class="line">updateUsername(id, user_name);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨ destructuring</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  id,</span><br><span class="line">  user_name  </span><br><span class="line">&#125; = data;</span><br><span class="line"></span><br><span class="line">updateUsername(id, user_name);</span><br></pre></td></tr></table></figure><a id="more"></a><p>æœ‰æ™‚ä¾¯functionä¸­çš„åƒæ•¸ä¹Ÿæœƒç”¨åˆ°destructuring</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// without destructuring</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunc</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> param1 = data.param1;</span><br><span class="line">  <span class="keyword">const</span> param2 = data.param2;</span><br><span class="line">  <span class="keyword">const</span> param3 = data.param3;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// with destructuring</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunc</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  param1,</span></span></span><br><span class="line"><span class="function"><span class="params">  param2,</span></span></span><br><span class="line"><span class="function"><span class="params">  param3</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™å€‹å¯«æ³•æœ‰ä¸€å€‹å¥½è™•<br>å› ç‚ºåŸæœ¬çš„å¯«æ³•åœ¨methodçš„åƒæ•¸ç•¶ä¸­ä½ åªçŸ¥é“å‚³é€²äº†dataä½†å»æ²’æœ‰èªªæ˜dataçš„æ ¼å¼ç‚ºä½•</p><p>åˆ©ç”¨Destructuringå‰‡å¯ä»¥æŠŠdataçš„æ ¼å¼æ›´æ¸…æ¥šåœ°åˆ—æ˜ï¼Œæœ‰æ•ˆæ¸›å°‘ä»£ç¢¼çš„éŒ¯èª¤ï¼Œäº¦æé«˜äº†ä»£ç¢¼çš„å¯è®€æ€§<br>ä½†ç•¶destructring é…åˆdefault parametersä¾†ä½¿ç”¨æ™‚å°±éœ€è¦å°å¿ƒäº†</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printParam</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  param1 = <span class="string">"default_value1"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  param2 = <span class="string">"default_value2"</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(param1);</span><br><span class="line">  <span class="built_in">console</span>.log(param2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚³ç©ºçš„objecté€²å»æ²’å•é¡Œ</span></span><br><span class="line">printParam(&#123;&#125;)</span><br><span class="line">&gt; default_value1</span><br><span class="line">&gt; default_value2</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚³å…¶ä¸­ä¸€å€‹åƒæ•¸ä¹Ÿæ²’å•é¡Œ</span></span><br><span class="line">printParam(&#123; <span class="attr">param1</span>: <span class="string">'somedata'</span> &#125;)</span><br><span class="line">&gt; somedata</span><br><span class="line">&gt; default_value2</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€™æ¨£å°±å‡ºå•é¡Œäº†</span></span><br><span class="line">printParam();</span><br><span class="line">&gt; <span class="built_in">TypeError</span>: Cannot destructure property <span class="string">`varA`</span> <span class="keyword">of</span> <span class="string">'undefined'</span> or <span class="string">'null'</span>.</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯printParamä¸­çš„default paramæ˜¯å»ºåŸºæ–¼ä½ å‚³é€²å»çš„objectï¼Œè€Œä¸¦ä¸æ˜¯ä¹‹å¤–çš„param<br>æ‰€ä»¥é€™æ¨£å¯«çš„æ™‚ä¾¯éœ€è¦åŠ å€å°å¿ƒ</p><p>æ­£ç¢ºçš„å¯«æ³•æ‡‰è©²æ˜¯é€™æ¨£  </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ã€€æ­£ç¢ºå¯«æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printParam</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  param1 = <span class="string">"default_value1"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  param2 = <span class="string">"default_value2"</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125; </span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(param1);</span><br><span class="line">  <span class="built_in">console</span>.log(param2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; default_value1</span><br><span class="line">&gt; default_value2</span><br></pre></td></tr></table></figure><p>é€™æ¨£å¯«å°±æœƒæŠŠæœ¬èº«è¦å‚³é€²å»çš„objectåƒæ•¸ä¹Ÿå»ºç«‹ä¸€å€‹é è¨­å€¼ï¼Œç•¶ä½ ä»€éº¼éƒ½æ²’å‚³é€²å»æ™‚å°±æœƒç”Ÿæˆä¸€å€‹ç©ºçš„object<br>ç„¶å¾Œå†æŠŠæœ¬èº«objectä¸­çš„åƒæ•¸æŒ‰é è¨­å€¼å†ç”Ÿæˆ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Destructuring (è§£æ§‹è³¦å€¼)æ˜¯es6ä¸­å¾ˆå¸¸ç”¨çš„èªæ³•&lt;br&gt;ç”¨è™•æ˜¯ä¸ç”¨é»(.)ä¾†é»(.)å»ï¼Œç›´æ¥æŠŠObjectä¸­çš„å€¼åŒ–ç‚ºå¯¦éš›è®Šé‡ä¾†ä½¿ç”¨&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç°¡å–®çš„ä¾‹å­&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; somdata = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id: &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  user_name: &lt;span class=&quot;string&quot;&gt;&quot;Nandi&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// èˆŠå¼å¯«æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; user\_name = data.user\_name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; id = data.id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;updateUsername(id, user_name);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ©ç”¨ destructuring&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  user_name  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;updateUsername(id, user_name);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="nodejs" scheme="https://blog.nandiheath.com/tags/nodejs/"/>
    
      <category term="javascript" scheme="https://blog.nandiheath.com/tags/javascript/"/>
    
      <category term="es6" scheme="https://blog.nandiheath.com/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetesä¸­æ¸…ç©ºä¸€å€‹nodeçš„æ‰€æœ‰pod</title>
    <link href="https://blog.nandiheath.com/2018/09/19/k8s-drain-pod-inside-node/"/>
    <id>https://blog.nandiheath.com/2018/09/19/k8s-drain-pod-inside-node/</id>
    <published>2018-09-19T11:16:26.000Z</published>
    <updated>2019-09-18T09:13:44.714Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰æ™‚ä¾¯kubernetesä¸­æœ‰äº›nodeæœƒå‡ºç¾æ•…éšœ é€™æ™‚ä¾¯å°±éœ€è¦ç”¨åˆ°å…©å€‹å‘½ä»¤ drainåŠuncordon</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆç²å–node çš„åå­—</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤nodeé–‹å§‹é‡‹æ”¾æ‰€æœ‰pod, ä¸¦ä¸”ä¸æ¥æ”¶æ–°çš„pod æ’ç¨‹</span></span><br><span class="line">kubectl drain [node-name] --force --ignore-daemonsets --delete-local-data</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># é€™æ™‚ä¾¯æŠŠè©²åšçš„äº‹æƒ…éƒ½åšä¸€ä¸‹ ...</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¾©nodeï¼Œå›å¾©æ¥æ”¶æ–°çš„pod æ’ç¨‹</span></span><br><span class="line">kubectl uncordon [node-name]</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="drainçš„åƒæ•¸"><a href="#drainçš„åƒæ•¸" class="headerlink" title="drainçš„åƒæ•¸"></a>drainçš„åƒæ•¸</h3><p><code>--force</code><br>ç•¶ä¸€äº›podä¸æ˜¯ç¶“ ReplicationController, ReplicaSet, Job, DaemonSet æˆ–è€… StatefulSet ç®¡ç†æ™‚<br>å°±éœ€è¦ç”¨<code>--force</code>ä¾†å¼·åˆ¶åŸ·è¡Œ (ä¾‹å¦‚:<strong>kube-proxy</strong>)</p><p><code>--ignore-daemonsets</code><br>ç„¡è¦–DaemonSetç®¡ç†ä¸‹çš„Pod</p><p><code>--delete-local-data</code><br>å¦‚æœæœ‰mount local volumnçš„podï¼Œæœƒå¼·åˆ¶æ®ºæ‰è©²podä¸¦æŠŠè³‡æ–™æ¸…é™¤æ‰<br>å¦å¤–å¦‚æœè·Ÿæœ¬èº«çš„é…ç½®è¨Šæ¯æœ‰è¡çªæ™‚ï¼Œdrainå°±ä¸æœƒåŸ·è¡Œ</p><p>ä¾‹å¦‚ä½ åœ¨ä¸€å€‹é‹è¡Œäº†ä¸‰å€‹replicaçš„statefulSetä¸­è¨­å®šäº†PodDisruptionBudgetï¼Œè€ŒminAvaliabilityåˆè¨­æˆäº†2ï¼Œç•¶æ­£åœ¨é‹è¡Œçš„podæ•¸é‡ç­‰æ–¼æˆ–å°‘æ–¼2çš„æ™‚ä¾¯ï¼Œdrainå°±æœƒåœæ­¢åŸ·è¡Œ</p><hr><h4 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h4><ul><li><a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ‰æ™‚ä¾¯kubernetesä¸­æœ‰äº›nodeæœƒå‡ºç¾æ•…éšœ é€™æ™‚ä¾¯å°±éœ€è¦ç”¨åˆ°å…©å€‹å‘½ä»¤ drainåŠuncordon&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å…ˆç²å–node çš„åå­—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl get nodes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å‘½ä»¤nodeé–‹å§‹é‡‹æ”¾æ‰€æœ‰pod, ä¸¦ä¸”ä¸æ¥æ”¶æ–°çš„pod æ’ç¨‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl drain [node-name] --force --ignore-daemonsets --delete-local-data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# é€™æ™‚ä¾¯æŠŠè©²åšçš„äº‹æƒ…éƒ½åšä¸€ä¸‹ ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# æ¢å¾©nodeï¼Œå›å¾©æ¥æ”¶æ–°çš„pod æ’ç¨‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kubectl uncordon [node-name]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="drain" scheme="https://blog.nandiheath.com/tags/drain/"/>
    
      <category term="kubectl" scheme="https://blog.nandiheath.com/tags/kubectl/"/>
    
  </entry>
  
  <entry>
    <title>AWSä¸­t2.mediumçš„äºŒä¸‰äº‹</title>
    <link href="https://blog.nandiheath.com/2018/09/19/aws-t2-medium/"/>
    <id>https://blog.nandiheath.com/2018/09/19/aws-t2-medium/</id>
    <published>2018-09-19T07:45:44.000Z</published>
    <updated>2019-09-18T09:13:44.706Z</updated>
    
    <content type="html"><![CDATA[<h2 id="t2ç³»åˆ—çš„å„ªé»"><a href="#t2ç³»åˆ—çš„å„ªé»" class="headerlink" title="t2ç³»åˆ—çš„å„ªé»"></a>t2ç³»åˆ—çš„å„ªé»</h2><h3 id="CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„"><a href="#CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„" class="headerlink" title="CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„"></a>CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„</h3><p>å¹³æ™‚ç”¨å‰©çš„å¯ä»¥ç´¯ç©ï¼Œç•¶ç„¶æ˜¯æœ‰ä¸Šé™å•¦<br>åˆ°éœ€è¦çˆ†ç™¼çš„æ™‚ä¾¯æŠŠå„²èµ·ä¾†çš„creditæ¶ˆè²»æ‰(?)<br>å¥½è™•æ˜¯ä½ ä¸€äº›é›£ä»¥ä¼°ç®—ç”¨é‡çš„serviceä½ å¯ä»¥æ”¾å¿ƒçš„è·‘èµ·ä¾†</p><h3 id="æ€§åƒ¹æ¯”é«˜"><a href="#æ€§åƒ¹æ¯”é«˜" class="headerlink" title="æ€§åƒ¹æ¯”é«˜"></a>æ€§åƒ¹æ¯”é«˜</h3><p>è·ŸåŒæ¨£é…ç½®çš„c4.large (2vCPU, 4GB Ram)<br>æ¯”èµ·ä¾†ä¾¿å®œä¸€åŠæœ‰å¤š($33.97 vs $73.20)</p><a id="more"></a><hr><p>æ‰€ä»¥æˆ‘åœ¨kubernetesç•¶ä¸­ç”¨çš„æ©Ÿå™¨å¤§éƒ¨ä»½éƒ½æ˜¯t2.medium<br>é›–ç„¶å¤§éƒ¨ä»½çš„æƒ…æ³ä¸‹éƒ½æ´»å¾—å¾ˆå¥½<br>ä½†ä¹Ÿæœ‰ç™¼ç”Ÿæ„å¤–çš„æ™‚ä¾¯<br>é‚£å°±æ˜¯<strong>CPU creditä¸å¤ </strong></p><p>é€™è£¡è¦å…ˆèªªæ˜ä¸€ä¸‹t2ç³»åˆ—çš„æ©Ÿåˆ¶<br>t2ç³»åˆ—çš„CPUç”¨é‡è·Ÿå…¶ä»–çš„ä¸åŒ<br>AWSæœƒç‚ºæ¯å€‹æ©Ÿå™¨æ¯å€‹å°æ™‚ç™¼ä¸€å®šé‡çš„CPU Credit<br>ç„¶å¾Œæ‰£å–ä½ è©²å°æ™‚çš„ç”¨é‡(1 credit = 100% CPU é‹è¡Œä¸€åˆ†é˜)<br>è€Œä¸åŒçš„instance typeå¯ä»¥å„²å­˜çš„credit ä¹Ÿæœ‰ä¸Šé™<br><img src="/images/aws-t2-medium-1.png" alt=""></p><p>å¦‚æœä½ é€£çºŒ200%CPUè·‘äº†å¥½é•·çš„ä¸€æ®µæ™‚é–“ï¼Œä½ çš„cpu creditå¾ˆå¿«å°±æœƒè®Šæˆ0<br>è€Œé€™å€‹æ™‚ä¾¯æ©Ÿå™¨ä¸Šæ‰€æœ‰çš„é€²ç¨‹åŸºæœ¬ä¸Šéƒ½æœƒå¡ä½ä¸å‹•<br>ç­‰åˆ°æœ‰CPU creditå›å¾©æ™‚æ‰è·‘ä¸€é»é»<br>ç°¡å–®ä¾†èªªå°±æ˜¯å¡æ­»äº†</p><p>æ‰€ä»¥å¦‚æœè¦æ‹¿t2ç³»åˆ—çš„æ©Ÿå™¨ä¾†åškubernetesçš„nodeçš„è©±<br>æœ‰å¹¾æ¨£äº‹æƒ…æ˜¯å¿…éœ€çš„</p><h2 id="æœ‰æ•ˆåˆ©ç”¨t2"><a href="#æœ‰æ•ˆåˆ©ç”¨t2" class="headerlink" title="æœ‰æ•ˆåˆ©ç”¨t2ã€€"></a>æœ‰æ•ˆåˆ©ç”¨t2ã€€</h2><h3 id="CPU-credit-ç›£æ§"><a href="#CPU-credit-ç›£æ§" class="headerlink" title="CPU credit ç›£æ§"></a>CPU credit ç›£æ§</h3><p>Prometheus å¯ä»¥å®‰è£ä¸€å€‹æ’ä»¶å»ç›£æ§AWSçš„E2 CPU Credit<br><img src="/images/aws-t2-medium-2.png" alt=""><br>æ–¼CPU creditç”¨é‡ç•°å¸¸æˆ–è€…æ˜¯ä¸å¤ çš„æ™‚ä¾¿ç™¼é€šçŸ¥(æˆ‘æ˜¯åˆ©ç”¨telegram)<br>ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨AWSçš„cloudwatchç›´æ¥ç›£æ§åŠç™¼é€šçŸ¥ï¼ŒåŸç†ä¸Šæ˜¯ä¸€æ¨£çš„</p><h3 id="åˆé©çš„è³‡æºé…ç½®"><a href="#åˆé©çš„è³‡æºé…ç½®" class="headerlink" title="åˆé©çš„è³‡æºé…ç½®"></a>åˆé©çš„è³‡æºé…ç½®</h3><p>åœ¨è¨­è¨ˆæ¯å€‹æœå‹™æ™‚æ‡‰è©²å…ˆè€ƒæ…®åˆ°å¯¦æ™‚çš„åŒé‡<br>ä¸ç„¶kubernetesåœ¨åˆ†é…è³‡æºçš„æ™‚ä¾¯å¾ˆæœ‰å¯èƒ½æŠŠä¸€å †æ¶ˆè€—CPU/å…§å­˜çš„å¤§æˆ¶æ”¾åœ¨åŒä¸€nodeä¸Š</p><p>ç•¶ç„¶åœ¨åˆæœŸå¾ˆé›£ä½œå‡ºæœ‰æ•ˆçš„ä¼°ç®—ï¼Œæ‰€ä»¥æˆ‘å»ºè­°åˆæœŸæ‡‰è©²èŠ±æ›´å¤šçš„æ™‚é–“å»åšç›£æ§<br>å¯†åˆ‡ç•™æ„æ¯å€‹æœå‹™çš„è³‡æºéœ€æ±‚ï¼Œä»¥ä¾¿æœ‰æ•ˆä½œå‡ºèª¿æ•´<br>ç•¶ç™¼ç¾éƒ¨ä»½æœå‹™çš„è³‡æºéœ€æ±‚éé«˜ï¼Œä½ å°±éœ€è¦ä½œå‡ºæ±ºå®š<br>ä¸€æ˜¯æŠŠä»–çš„resource requestèª¿é«˜ï¼ŒæŠŠå…¶ä»–æœå‹™æ“ èµ°<br>åˆæˆ–è€…å°ˆé–€é…ç½®ä¸€äº›nodeçµ¦ä»–å€‘å–®ç¨è·‘</p><p>æœ€å¾Œåæ§½ä¸€ä¸‹<br>gcloudæ²’æœ‰é¡ä¼¼çš„brustable instanceï¼Œå·®è©•</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="/2018/02/22/grafana-prometheus/" title="åˆ©ç”¨Prometheuså»ç›£æ§AWS EC2çš„CPU credit">åˆ©ç”¨Prometheuså»ç›£æ§AWS EC2çš„CPU credit</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;t2ç³»åˆ—çš„å„ªé»&quot;&gt;&lt;a href=&quot;#t2ç³»åˆ—çš„å„ªé»&quot; class=&quot;headerlink&quot; title=&quot;t2ç³»åˆ—çš„å„ªé»&quot;&gt;&lt;/a&gt;t2ç³»åˆ—çš„å„ªé»&lt;/h2&gt;&lt;h3 id=&quot;CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„&quot;&gt;&lt;a href=&quot;#CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„&quot; class=&quot;headerlink&quot; title=&quot;CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„&quot;&gt;&lt;/a&gt;CPUæ˜¯æŒ‰ç”¨é‡ç®—çš„&lt;/h3&gt;&lt;p&gt;å¹³æ™‚ç”¨å‰©çš„å¯ä»¥ç´¯ç©ï¼Œç•¶ç„¶æ˜¯æœ‰ä¸Šé™å•¦&lt;br&gt;åˆ°éœ€è¦çˆ†ç™¼çš„æ™‚ä¾¯æŠŠå„²èµ·ä¾†çš„creditæ¶ˆè²»æ‰(?)&lt;br&gt;å¥½è™•æ˜¯ä½ ä¸€äº›é›£ä»¥ä¼°ç®—ç”¨é‡çš„serviceä½ å¯ä»¥æ”¾å¿ƒçš„è·‘èµ·ä¾†&lt;/p&gt;
&lt;h3 id=&quot;æ€§åƒ¹æ¯”é«˜&quot;&gt;&lt;a href=&quot;#æ€§åƒ¹æ¯”é«˜&quot; class=&quot;headerlink&quot; title=&quot;æ€§åƒ¹æ¯”é«˜&quot;&gt;&lt;/a&gt;æ€§åƒ¹æ¯”é«˜&lt;/h3&gt;&lt;p&gt;è·ŸåŒæ¨£é…ç½®çš„c4.large (2vCPU, 4GB Ram)&lt;br&gt;æ¯”èµ·ä¾†ä¾¿å®œä¸€åŠæœ‰å¤š($33.97 vs $73.20)&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="aws" scheme="https://blog.nandiheath.com/tags/aws/"/>
    
      <category term="prometheus" scheme="https://blog.nandiheath.com/tags/prometheus/"/>
    
      <category term="t2.medium" scheme="https://blog.nandiheath.com/tags/t2-medium/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch Clusterå‡ºäº‹äº†</title>
    <link href="https://blog.nandiheath.com/2018/09/19/elasticsearch-cluster-oom/"/>
    <id>https://blog.nandiheath.com/2018/09/19/elasticsearch-cluster-oom/</id>
    <published>2018-09-19T03:33:30.000Z</published>
    <updated>2019-09-18T09:13:44.712Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€æ¬¡åœ¨kibanaä¸Šçš„è·¨indexæœç´¢å¾Œ<br>elasticsearchå…¶ä¸­ä¸€å€‹nodeå°±ä¸æ–·é‡å•Ÿ<br>è€Œæ¯æ¬¡reshardçš„æ™‚é–“ä¹Ÿè¶Šä¾†è¶Šé•·<br><img src="/images/elasticsearch-cluster-oom-0.png" alt=""></p><p>æœ€å¾Œç™¼ç¾å•é¡ŒåŸä¾†å‡ºè‡ªkubernetesä¸Š<br>æ”¾esçš„ç¯€é»ä¸Šå¿˜è¨˜æŠŠä»–taintäº†<br>çµæœå…¶ä»–PODä¹Ÿåˆ†é…åˆ°ä¸Šé¢é‹è¡Œ<br>çµæœå°±é€ æˆäº†ä¸€å€‹æƒ¡æ€§å¾ªç’°<br>å…§å­˜ä½”ç”¨å¤ªå¤šå°è‡´OOM &gt; PODé‡å•Ÿ &gt;ã€€ESç¯€é»é‡æ–°åŠ å…¥åˆ°ES cluster &gt; é‡æ–°åˆ†é…shard &gt; å…§å­˜ä½”ç”¨å¤ªå¤šå°è‡´OOM  </p><p>é›–ç„¶èªªæ˜¯k8sçš„è¨­å®šä¸ç•¶<br>ä½†esä¸Šçš„ç¢ºä¹Ÿæœ‰äº›è¨­å®šå•é¡Œéœ€è¦æ”¹å–„</p><a id="more"></a><hr><h3 id="1-shardæ•¸é‡å¤ªå¤š"><a href="#1-shardæ•¸é‡å¤ªå¤š" class="headerlink" title="1. shardæ•¸é‡å¤ªå¤š"></a>1. shardæ•¸é‡å¤ªå¤š</h3><p>é¦–å…ˆç”±æ–¼é€™å€‹ESæ˜¯ç”¨ä¾†åˆ†ææ—¥èªŒï¼Œä¸åŒçš„serviceçš„indexä¹Ÿä¸åŒï¼Œè€Œindexæ¡ç”¨çš„æ˜¯[env]-[service]-[YYYY-MM-DD]é€™å€‹æ–¹å¼ï¼Œçµæœæ¯æ—¥ç”¢ç”Ÿçš„indexæ•¸é‡å°±æ˜¯å¤§æ¦‚ 5 x 3 x 2(3å€‹ç’°å¢ƒ dev/stag/prodï¼Œ5å€‹æœå‹™ï¼Œæ¯å€‹indexå…©å€‹shard)</p><h4 id="è§£æ±ºæ–¹æ¡ˆ"><a href="#è§£æ±ºæ–¹æ¡ˆ" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h4><p>æœƒç”¨curatoråˆªæ‰çš„indexæ‰ç”¨YYYY-MM-DD,ã€€å…¶ä»–çš„ç”¨YYYY-MMå°±å¯ä»¥äº†ï¼Œå› ç‚ºé€šå¸¸åªæŸ¥è©¢å…©å€‹æœˆå…§çš„æ•¸æ“š<br>è€Œæ¡ç”¨YYYY-MMçš„æ‡‰è©²è¨­å®šæˆshard: 5, replica: 1ï¼Œæ–¹ä¾¿è² æˆ´ç®¡ç†<br>ä¹Ÿå¯ä»¥åˆ©ç”¨/index/closeçš„æŒ‡ä»¤ä¾†æŠŠå¾ˆå°‘ç”¨çš„indexé—œæ‰ï¼Œé›–ç„¶èªªæœƒé¡å¤–å¢çš„ç¡¬ç¢Ÿå®¹é‡â€¦ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-open-close.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-open-close.html</a></p><h3 id="2-master-data-node-è² è¼‰ä¸å‡"><a href="#2-master-data-node-è² è¼‰ä¸å‡" class="headerlink" title="2. master/data node è² è¼‰ä¸å‡"></a>2. master/data node è² è¼‰ä¸å‡</h3><p>å› ç‚ºçœéŒ¢çš„é—œä¿‚åªé–‹äº†å…©å°AWS R4çš„node,ï¼Œå„è‡ªæœ‰ä¸€å€‹master + data node<br>ä½è² è¼‰ç’°å¢ƒä¸‹æ²’å•é¡Œï¼Œä½†æ¯ç•¶rescheduleçš„æ™‚ä¾¯CPUå°±æœƒè¡åˆ°å¾ˆé«˜äº†</p><h4 id="è§£æ±ºæ–¹æ¡ˆ-1"><a href="#è§£æ±ºæ–¹æ¡ˆ-1" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h4><p>å¤šé…å…©å°æ©Ÿä¾†è·‘master<br>é›–ç„¶æ–‡æª”èªªmasteréœ€æ±‚ä¸å¤§ï¼Œä½†â€ä¸å¤§â€ä¹Ÿåªæ˜¯ç›¸å°èµ·data nodeä¾†èªªâ€¦</p><h3 id="3-replicaè¨­å®šä¸ç•¶"><a href="#3-replicaè¨­å®šä¸ç•¶" class="headerlink" title="3. replicaè¨­å®šä¸ç•¶"></a>3. replicaè¨­å®šä¸ç•¶</h3><p><code>shard:1 replica:1</code>åœ¨åªæœ‰å…©å€‹data nodeçš„æ™‚ä¾¯æ˜¯ç›¸ç•¶é›è‚‹çš„<br>è€Œä¸”é€™é‚Šæˆ‘ä¹Ÿä¸è‚¯å®šåˆ°åº•æ˜¯ä¸æ˜¯hard affinity<br>æœ‰æ™‚é‡rescheduleçš„æ™‚ä¾¿ç¸½ç™¼ç¾æœ‰å°‘éƒ¨ä»½( ~50/20000)çš„unassigned_shards</p><h4 id="è§£æ±ºæ–¹æ¡ˆ-2"><a href="#è§£æ±ºæ–¹æ¡ˆ-2" class="headerlink" title="è§£æ±ºæ–¹æ¡ˆ"></a>è§£æ±ºæ–¹æ¡ˆ</h4><p>æœ€å°‘é…ç½®ï¼“å°data node<br>è€Œä¸”ç”¨åŸæœ¬çš„é…ç½®<code>shard:5 replica:1</code><br>ä½†å‰æindexçš„æ•¸é‡è¦å°‘ä½†å®¹é‡è¦å¤§<br>logå‹å¼çš„indexé‚„æ˜¯ç”¨å›<code>shard:1 replica:1</code>çš„é…ç½®</p><h3 id="çµè«–"><a href="#çµè«–" class="headerlink" title="çµè«–"></a>çµè«–</h3><p>elastic searchè£¡é¢æœ‰å¾ˆå¤šå¾ˆå¤šè¨­å®š<br>ä¸€é–‹å§‹çš„æ™‚ä¾¯è³‡æ–™é‡ä¸å¤§ï¼Œä¸æœƒå¼•èµ·å¤ªå¤§å•é¡Œ<br>ä½†ç•¶æ•¸é‡å¢åŠ åˆ°æŸå€‹é‡ç´šçš„æ™‚ä¾¯å°±æœƒé–‹å§‹é€ æˆä¸€å †å•é¡Œ<br>ç†æƒ³ç•¶ç„¶æ˜¯åœ¨é–‹å§‹è¨­è¨ˆæ¶æ§‹çš„æ™‚ä¾¯å°±å·²ç¶“è€ƒæ…®åˆ°æ¯ç¨®<code>index</code>çš„æ‡‰ç”¨ç‹€æ³<br>å¾è€Œè¨­å®šå¥½<code>shard</code>/<code>replica</code>ç­‰çš„æ•¸é‡<br>å¦å‰‡ä¸Šç·šä¹‹å¾Œæ‰æ›´æ”¹<code>index</code>æˆ–ç›¸é—œçš„è¨­å®šå¯æ˜¯ç›¸ç•¶å±éšªçš„â€¦</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ä¸€æ¬¡åœ¨kibanaä¸Šçš„è·¨indexæœç´¢å¾Œ&lt;br&gt;elasticsearchå…¶ä¸­ä¸€å€‹nodeå°±ä¸æ–·é‡å•Ÿ&lt;br&gt;è€Œæ¯æ¬¡reshardçš„æ™‚é–“ä¹Ÿè¶Šä¾†è¶Šé•·&lt;br&gt;&lt;img src=&quot;/images/elasticsearch-cluster-oom-0.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€å¾Œç™¼ç¾å•é¡ŒåŸä¾†å‡ºè‡ªkubernetesä¸Š&lt;br&gt;æ”¾esçš„ç¯€é»ä¸Šå¿˜è¨˜æŠŠä»–taintäº†&lt;br&gt;çµæœå…¶ä»–PODä¹Ÿåˆ†é…åˆ°ä¸Šé¢é‹è¡Œ&lt;br&gt;çµæœå°±é€ æˆäº†ä¸€å€‹æƒ¡æ€§å¾ªç’°&lt;br&gt;å…§å­˜ä½”ç”¨å¤ªå¤šå°è‡´OOM &amp;gt; PODé‡å•Ÿ &amp;gt;ã€€ESç¯€é»é‡æ–°åŠ å…¥åˆ°ES cluster &amp;gt; é‡æ–°åˆ†é…shard &amp;gt; å…§å­˜ä½”ç”¨å¤ªå¤šå°è‡´OOM  &lt;/p&gt;
&lt;p&gt;é›–ç„¶èªªæ˜¯k8sçš„è¨­å®šä¸ç•¶&lt;br&gt;ä½†esä¸Šçš„ç¢ºä¹Ÿæœ‰äº›è¨­å®šå•é¡Œéœ€è¦æ”¹å–„&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="elasticsearch" scheme="https://blog.nandiheath.com/tags/elasticsearch/"/>
    
      <category term="kubenetes" scheme="https://blog.nandiheath.com/tags/kubenetes/"/>
    
      <category term="taint" scheme="https://blog.nandiheath.com/tags/taint/"/>
    
  </entry>
  
  <entry>
    <title>[è½‰è¼‰]å¯«çµ¦å·¥ç¨‹å¸«çš„åæ¢ç²¾é€²åŸå‰‡</title>
    <link href="https://blog.nandiheath.com/2018/08/23/ten-principles-for-software-engineers/"/>
    <id>https://blog.nandiheath.com/2018/08/23/ten-principles-for-software-engineers/</id>
    <published>2018-08-23T09:34:25.000Z</published>
    <updated>2019-09-18T09:13:44.717Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çœ‹åˆ°ç¾åœ˜çš„æŠ€è¡“åœ˜éšŠæ‰€å¯«çš„ä¸€ç¯‡æ–‡ç« æœ‰æ„Ÿï¼Œç‰¹æ­¤åˆ†äº«<br>å‚³é€é–€: <a href="https://tech.meituan.com/10_principles_for_engineers.html" target="_blank" rel="noopener">https://tech.meituan.com/10_principles_for_engineers.html</a><br>è£¡é¢æåˆ°æœ‰å¹¾é»ä¹Ÿæ˜¯ç¾åœ¨æˆ‘çš„åœ˜éšŠæ‰€ç¼ºä¹çš„ï¼Œè—‰æ­¤ä¹Ÿå¯å¥½å¥½æª¢è¦–ä¸‹è‡ªå·±çš„ä¸è¶³  </p><h2 id="ä»¥ç»ˆä¸ºå§‹"><a href="#ä»¥ç»ˆä¸ºå§‹" class="headerlink" title="ä»¥ç»ˆä¸ºå§‹"></a>ä»¥ç»ˆä¸ºå§‹</h2><blockquote><p>â€œä»¥ç»ˆä¸ºå§‹â€ï¼ˆBegin With The End In Mindï¼‰ï¼Œæ˜¯å²è’‚èŠ¬Â·æŸ¯ç»´åœ¨ã€Šé«˜æ•ˆèƒ½äººå£«çš„ä¸ƒä¸ªä¹ æƒ¯ã€‹ä¸­æåˆ°çš„ä¸€ä¸ªä¹ æƒ¯ã€‚å®ƒæ˜¯ä»¥æ‰€æœ‰äº‹ç‰©éƒ½ç»è¿‡ä¸¤æ¬¡åˆ›é€ çš„åŸåˆ™ï¼ˆç¬¬ä¸€æ¬¡ä¸ºå¿ƒæ™ºä¸Šçš„åˆ›é€ ï¼Œç¬¬äºŒæ¬¡ä¸ºå®é™…çš„åˆ›é€ ï¼‰ä¸ºåŸºç¡€çš„ã€‚ç›´è§‚çš„è¡¨è¾¾å°±æ˜¯ï¼š<strong>å…ˆæƒ³æ¸…æ¥šç›®æ ‡ï¼Œç„¶ååŠªåŠ›å®ç°ã€‚</strong></p></blockquote><p>å¾ˆå¤šæ™‚ä¾¯å·¥ç¨‹å¸«çš„å£ç¿’æ…£å°±æ˜¯æƒ³åˆ°å°±å‹•æ‰‹åšï¼Œä½†æ²’è¦åŠƒå¥½åšå‡ºä¾†çš„å…¶å¯¦è·Ÿéœ€æ±‚ç›¸å»ç”šé <br>å…ˆæƒ³æ¸…æ¥šï¼Œåˆ¶å®šå¥½ä¸€å€‹èƒ½é‡åŒ–çš„ç›®æ¨™<br>ç„¶å¾Œä»¥è©²ç›®æ¨™ç‚ºå‰é¡ŒæŠŠéœ€è¦çš„æ­¥é©Ÿè©³åˆ—å‡ºä¾†<br>ç‚ºåšè€Œåšä¸¦ä¸æœƒç‚ºé …ç›®å¸¶ä¾†ä»€éº¼</p><a id="more"></a><h2 id="é—­ç¯æ€ç»´"><a href="#é—­ç¯æ€ç»´" class="headerlink" title="é—­ç¯æ€ç»´"></a>é—­ç¯æ€ç»´</h2><blockquote><p><strong>çœŸæ­£çš„é—­ç¯ï¼Œè¦æ±‚æˆ‘ä»¬å¯¹å·¥ä½œä¸­çš„äº‹æƒ…éƒ½èƒ½å¤Ÿå…»æˆè‰¯å¥½çš„æ€ç»´ä¹ æƒ¯ï¼Œæ²Ÿé€šè¦æœ‰ç»“è®ºï¼Œé€šçŸ¥è¦æœ‰åé¦ˆï¼ŒTo Doè¦æœ‰éªŒæ”¶ã€‚</strong></p></blockquote><p>è·Ÿä¸€ç›´ä»¥ä¾†æå€¡çš„TDDå¾ˆç›¸ä¼¼ï¼Œç¾å¯¦å»æ˜¯æ™‚é–“ä¸å®¹è¨±<br>å¾ˆå¤šæ™‚ä¾¯è·Ÿåˆ¥äººè¨è«–ä¸€å¤§è¼ªçµæœå»ä¸äº†äº†ä¹‹ï¼Œé€™å€‹æ™‚ä¾¯å°±æ‡‰è©²ç”±Ownerä¸»å°ï¼Œè¨‚ä¸‹ç›¸é—œçš„ç›®æ¨™åŠé©—æ”¶æº–å‰‡<br>å¥½è®“ä¸€ä»¶äº‹æœ‰ä¸€å€‹ã€é–‰ç’°ã€ï¼Œé€™å°±è·Ÿscrumçš„workflowé¡ä¼¼<br><code>PENDING&gt;IN PROGRESS&gt;WAITING FOR REVIEW&gt; CLOSE</code><br>æ°¸é éœ€è¦ä¸€å€‹CLOSEï¼Œå¦å‰‡issueåªæœƒç„¡é™çš„ç´¯ç©ä¸‹å»</p><h2 id="äº‹ä¸è¿‡äºŒ"><a href="#äº‹ä¸è¿‡äºŒ" class="headerlink" title="äº‹ä¸è¿‡äºŒ"></a>äº‹ä¸è¿‡äºŒ</h2><blockquote><p>  ä¸€å±‚å«ä¹‰æ˜¯<strong>â€œæ‰€æœ‰çš„è¯„å®¡ä¸é—®é¢˜è®¨è®ºï¼Œä¸è¦è¶…è¿‡ä¸¤æ¬¡â€</strong>ã€‚ â€¦â€¦ â€œäº‹ä¸è¿‡äºŒâ€åŸåˆ™çš„å¦ä¸€å±‚å«ä¹‰ï¼Œæ˜¯<strong>â€œåŒæ ·çš„é”™è¯¯ä¸èƒ½çŠ¯ç¬¬äºŒæ¬¡â€</strong>ã€‚æ¯æ¬¡æ•…éšœä¹‹åï¼ŒCasestudyéƒ½å¿…é¡»è¿›è¡Œæ·±åˆ»çš„æ€»ç»“å¤ç›˜ï¼Œå¯¹æ•…éšœåŸå› è¿›è¡Œ5Whyåˆ†æï¼Œç»™å‡ºæ˜ç¡®å¯æ‰§è¡Œçš„To Do Listã€‚</p></blockquote><p>äº‹ä¸éäºŒæ˜¯ä¸€å€‹é‡è¦çš„æ€ç¶­ï¼Œç„¡è«–æ˜¯è¨è«–é‚„æ˜¯é™¤éŒ¯ã€‚å·¥ä½œä¸Šç„¡æ•¸æ¬¡å‡ºç¾éå°±åŒä¸€äº‹æƒ…ç™¼ç”ŸNæ¬¡çš„è¨è«–ï¼Œæœ€å¾Œä¹Ÿæ²’æœ‰çµè«–ã€‚å•é¡Œé‡å¿ƒå…¶ä¸€æ˜¯ç¼ºä¹Ownerä¸»å°ï¼Œæ²’æœ‰æ˜ç¢ºçš„è¨è«–æ–¹å‘ï¼Œå¾ˆå¤šæ™‚ä¾¯è¨è«–åˆ°æµæ–¼è¡¨é¢ï¼Œæˆ–åªå°±çœ¼å‰ç™¼ç”Ÿçš„äº‹æƒ…è¨è«–ï¼Œæ²’æœ‰å®šè«–ä¹Ÿå°±ä¸èƒ½é–‰ç’°ï¼›å…¶äºŒæ˜¯ç¼ºä¹æ–‡æª”ï¼Œå°è‡´ä¹‹å¾Œæœƒå¿˜è¨˜ä»¥å‰æ‰€è¨è«–çš„å…§å®¹ã€‚ è§£æ±ºæ–¹æ¡ˆæ˜¯åŠ å…¥Owneræ€ç¶­ï¼ŒåŠæ¯æ¬¡è¨è«–éƒ½éœ€è¦æœ‰ä¸€å€‹æ˜ç¢ºçš„TODOï¼Œä¸¦éœ€è¦æŠŠçµè«–å¯«é€²æ–‡æª”   è€Œé™¤éŒ¯äº¦æ˜¯å¦ä¸€å€‹å•é¡Œæ‰€åœ¨ã€‚æ¯ç•¶æœ‰BUGå‡ºç¾æ™‚ï¼Œå¤§å¤šéƒ½æ²’æœ‰è©³ç´°æŠŠè©²å•é¡Œåˆ†ç´šï¼Œè€Œæ˜¯é¸æ“‡ç«‹å³å»è§£æ±ºï¼Œäº‹å¾Œä¹Ÿæ²’æœ‰è©³ç´°çš„è¨˜éŒ„ç›¸é—œçš„æ­¥é©Ÿã€‚è€Œä¹‹å¾ŒåŒæ¨£çš„å•é¡Œå†æ¬¡å‡ºç¾æ™‚ï¼Œå°±æ˜¯æ†‘ç¶“é©—å»è§£æ±ºï¼Œä½†å¾ˆå¤šæ™‚ä¾¯éƒ½æœƒé‡æ–°æ€è€ƒä¸€äº›æ›¾ç¶“ç¶“éçš„æ­¥é©Ÿï¼Œåšæˆæµªè²»ã€‚ è§£æ±ºæ–¹æ¡ˆç•¶ç„¶æ˜¯æŠŠé™¤éŒ¯æ­¥é©Ÿå¯«é€²æ–‡æª”ï¼Œä½†äº¦éœ€è¦æ‹¿æç•¶ä¸­çš„ç¨‹åº¦ï¼Œè€ƒæ…®ä»€éº¼é¡å‹çš„BUGæ‰éœ€è¦è©³åˆ—å…¶æ­¥é©Ÿã€‚  </p><h2 id="è®¾è®¡ä¼˜å…ˆ"><a href="#è®¾è®¡ä¼˜å…ˆ" class="headerlink" title="è®¾è®¡ä¼˜å…ˆ"></a>è®¾è®¡ä¼˜å…ˆ</h2><blockquote><p>â€œè®¾è®¡ä¼˜å…ˆâ€è¿™æ¡åŸåˆ™ï¼Œç›¸å¯¹æ¥è¯´æ›´åŠ å…·ä½“ä¸€äº›ã€‚ä¹‹æ‰€ä»¥å•åˆ—ä¸€é¡¹ï¼Œæ˜¯å› ä¸ºæ¶æ„è®¾è®¡å¤ªé‡è¦äº†ã€‚Uncle Bobæ›¾è¯´è¿‡ï¼šâ€œè½¯ä»¶æ¶æ„çš„ç›®æ ‡ï¼Œæ˜¯ä¸ºäº†è®©æ„å»ºä¸ç»´æŠ¤ç³»ç»Ÿçš„æ‰€éœ€äººåŠ›èµ„æºæœ€å°åŒ–ã€‚â€ <strong>â€¦â€¦</strong> <strong>â€œè®¾è®¡ä¼˜å…ˆâ€è¿™ä¸€åŸåˆ™ï¼Œè¦æ±‚å†™åˆ«äººçœ‹å¾—æ‡‚çš„è®¾è®¡</strong>ã€‚æˆ‘ä»¬äº†è§£ä¸€ä¸ªç³»ç»Ÿæœ€ç›´æ¥çš„é€”å¾„å°±æ˜¯ç»“åˆè®¾è®¡æ–‡æ¡£ä¸ä»£ç ã€‚</p></blockquote><p>MD&gt;5å°±éœ€è¦æ–‡æª”ï¼Œçµ•å°åŒæ„  </p><h2 id="ç©ºæ¯å¿ƒæ€"><a href="#ç©ºæ¯å¿ƒæ€" class="headerlink" title="ç©ºæ¯å¿ƒæ€"></a>ç©ºæ¯å¿ƒæ€</h2><blockquote><p>â€œæ»¡æ‹›æŸï¼Œè°¦å—ç›Šâ€ï¼Œâ€œç©ºæ¯å¿ƒæ€â€æ˜¯æœ€åä¸€é¡¹åŸåˆ™ã€‚æˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯ä¸€ä¸ªäººèƒ½å¤ŸæŒç»­æˆé•¿çš„å‰æã€‚åšæŠ€æœ¯çš„äººï¼Œéª¨å­é‡Œé€šå¸¸æœ‰è‚¡å‚²æ°”ï¼Œå¹¶ä¸”ä¼šéšç€èµ„å†ã€æˆç»©çš„æå‡è€Œä¸æ–­å¢åŠ ã€‚</p></blockquote><p>å¸¸è¨€é“ï¼šå­¸è€Œå¾ŒçŸ¥ä¸è¶³<br>ä½ æ‡‚çš„å†å¤šï¼Œä½†æ¯å€‹äººä¹Ÿè‚¯å®šæœƒæ‡‚ä¸€äº›ä½ ä¸æ‡‚çš„äº‹<br>æ“ºæ­£å¿ƒæ…‹ï¼Œä½ éœ€è¦çš„æ˜¯é€²æ­¥ï¼Œè€Œä¸æ˜¯è‡ªæ»¿<br></p><p>ä»¥ä¸Šï¼Œå…±å‹‰ä¹‹</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘çœ‹åˆ°ç¾åœ˜çš„æŠ€è¡“åœ˜éšŠæ‰€å¯«çš„ä¸€ç¯‡æ–‡ç« æœ‰æ„Ÿï¼Œç‰¹æ­¤åˆ†äº«&lt;br&gt;å‚³é€é–€: &lt;a href=&quot;https://tech.meituan.com/10_principles_for_engineers.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://tech.meituan.com/10_principles_for_engineers.html&lt;/a&gt;&lt;br&gt;è£¡é¢æåˆ°æœ‰å¹¾é»ä¹Ÿæ˜¯ç¾åœ¨æˆ‘çš„åœ˜éšŠæ‰€ç¼ºä¹çš„ï¼Œè—‰æ­¤ä¹Ÿå¯å¥½å¥½æª¢è¦–ä¸‹è‡ªå·±çš„ä¸è¶³  &lt;/p&gt;
&lt;h2 id=&quot;ä»¥ç»ˆä¸ºå§‹&quot;&gt;&lt;a href=&quot;#ä»¥ç»ˆä¸ºå§‹&quot; class=&quot;headerlink&quot; title=&quot;ä»¥ç»ˆä¸ºå§‹&quot;&gt;&lt;/a&gt;ä»¥ç»ˆä¸ºå§‹&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;â€œä»¥ç»ˆä¸ºå§‹â€ï¼ˆBegin With The End In Mindï¼‰ï¼Œæ˜¯å²è’‚èŠ¬Â·æŸ¯ç»´åœ¨ã€Šé«˜æ•ˆèƒ½äººå£«çš„ä¸ƒä¸ªä¹ æƒ¯ã€‹ä¸­æåˆ°çš„ä¸€ä¸ªä¹ æƒ¯ã€‚å®ƒæ˜¯ä»¥æ‰€æœ‰äº‹ç‰©éƒ½ç»è¿‡ä¸¤æ¬¡åˆ›é€ çš„åŸåˆ™ï¼ˆç¬¬ä¸€æ¬¡ä¸ºå¿ƒæ™ºä¸Šçš„åˆ›é€ ï¼Œç¬¬äºŒæ¬¡ä¸ºå®é™…çš„åˆ›é€ ï¼‰ä¸ºåŸºç¡€çš„ã€‚ç›´è§‚çš„è¡¨è¾¾å°±æ˜¯ï¼š&lt;strong&gt;å…ˆæƒ³æ¸…æ¥šç›®æ ‡ï¼Œç„¶ååŠªåŠ›å®ç°ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¾ˆå¤šæ™‚ä¾¯å·¥ç¨‹å¸«çš„å£ç¿’æ…£å°±æ˜¯æƒ³åˆ°å°±å‹•æ‰‹åšï¼Œä½†æ²’è¦åŠƒå¥½åšå‡ºä¾†çš„å…¶å¯¦è·Ÿéœ€æ±‚ç›¸å»ç”šé &lt;br&gt;å…ˆæƒ³æ¸…æ¥šï¼Œåˆ¶å®šå¥½ä¸€å€‹èƒ½é‡åŒ–çš„ç›®æ¨™&lt;br&gt;ç„¶å¾Œä»¥è©²ç›®æ¨™ç‚ºå‰é¡ŒæŠŠéœ€è¦çš„æ­¥é©Ÿè©³åˆ—å‡ºä¾†&lt;br&gt;ç‚ºåšè€Œåšä¸¦ä¸æœƒç‚ºé …ç›®å¸¶ä¾†ä»€éº¼&lt;/p&gt;
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="software-engineering" scheme="https://blog.nandiheath.com/tags/software-engineering/"/>
    
  </entry>
  
  <entry>
    <title>Prometheusä¸­ç›£æ§AWS EC2çš„CPU credit</title>
    <link href="https://blog.nandiheath.com/2018/08/14/ec2-cpu-credit-monitoring-in-prometheus/"/>
    <id>https://blog.nandiheath.com/2018/08/14/ec2-cpu-credit-monitoring-in-prometheus/</id>
    <published>2018-08-14T07:59:19.000Z</published>
    <updated>2019-09-18T09:13:44.711Z</updated>
    
    <content type="html"><![CDATA[<p>å…¬å¸ç”¨çš„kubernetes nodeså¤§éƒ¨ä»½éƒ½æ˜¯t2 type<br>å¥½è™•æ˜¯ä¾¿å®œã€å½ˆæ€§å¤§ï¼Œä½†å£è™•ä¹Ÿç›¸ç•¶æ˜é¡¯<br>ç•¶CPUä½¿ç”¨ç‡æ¯”CPU creditå›å¾©çš„é€Ÿåº¦æ…¢æ™‚ï¼Œæœ‰æ©Ÿæœƒå°è‡´cpu creditè®Šæˆ0(æˆ–è€…ç›¸ç•¶æ¥è¿‘0)<br>å°è‡´è©²ç¯€é»çš„CPUæ•ˆèƒ½é™åˆ°æ¥µä½ï¼Œå¤§éƒ¨ä»½é€²ç¨‹éƒ½æœƒå¡ä½ç”šè‡³ç•¶æ©Ÿ<br>é€™å€‹æƒ…æ³å·²ç¶“ç™¼ç”Ÿéä¸åªä¸€æ¬¡<br>ä¾‹å¦‚åœ¨æŸå€‹nodeä¸Šçš„rabbitmq(å°ï¼Œæ²’æœ‰ç”¨åˆ°dedicated çš„node)<br>å› ç‚ºæœ‰å€‹chromiumçš„podåœ¨åŒä¸€æ©Ÿå™¨ä¸Šè·‘ï¼Œè€Œä¸”ä»–æ˜¯ä»¥cron jobå½¢å¼å»è·‘ï¼Œå†åŠ ä¸Šæœ‰è©²æ­»bugï¼Œäº¦æ²’æœ‰è¨­å®šretry count<br>çµæœå°±æ˜¯å±±ç©äº†ä¸€å †jobåœ¨åŒä¸€å€‹nodeä¸Šä¸åœè·‘<br>éäº†å¹¾å¤©æ•´å€‹CPU creditè®Šæˆ0ï¼Œrabbitmqæ›æ‰<br>å¾ˆå¤šå…¶ä»–podä¹Ÿå› æ­¤å¡æ­»(æˆ–è€…ä¸æ–·é‡å•Ÿ)</p><a id="more"></a><hr><p>ç¾åœ¨åŠ äº†prometheusçš„cloudwatch plugin<br>ç•¶cpu creditä½¿ç”¨ç‡éé«˜æ™‚æœƒç›´æ¥ç¶“telegramé€šçŸ¥æˆ‘ï¼Œå•é¡Œå°±è§£æ±ºäº†ï¼(å¸Œæœ›)</p><p>è¦æ³¨æ„çš„æ˜¯cloudwatch APIæ˜¯éœ€è¦<strong>ä»˜è²»</strong>çš„<br>æœç„¶å¤©ä¸‹ç„¡å…è²»çš„åˆé¤â€¦</p><hr><p>Prometheus çš„alertå¯«æ³•:<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">cpu_credit</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">CPUCreditTooHigh</span></span><br><span class="line">    <span class="comment"># count the rate (per second) of last 2 hour. if the rate is less than 0 that means the cpu usage is dropping</span></span><br><span class="line">    <span class="comment"># May need to alter to see if the alerts send too rapidly</span></span><br><span class="line"><span class="attr">    expr:</span> <span class="string">avg</span> <span class="string">by</span> <span class="string">(instance_id)</span> <span class="string">(rate(aws_ec2_cpucredit_balance_average[2h]))</span> <span class="string">&lt;</span> <span class="number">0</span></span><br><span class="line"><span class="attr">    for:</span> <span class="number">2</span><span class="string">h</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">critical</span></span><br><span class="line"><span class="attr">    annotations:</span></span><br><span class="line"><span class="attr">      summary:</span> <span class="string">"CPU credit is running low on <span class="template-variable">&#123;&#123;$labels.instace_id&#125;&#125;</span>"</span></span><br></pre></td></tr></table></figure></p><hr><h4 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h4><ul><li><a href="https://github.com/prometheus/cloudwatch_exporter" target="_blank" rel="noopener">https://github.com/prometheus/cloudwatch_exporter</a></li><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/viewing_metrics_with_cloudwatch.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/viewing_metrics_with_cloudwatch.html</a></li><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/t2-instances-monitoring-cpu-credits.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/t2-instances-monitoring-cpu-credits.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…¬å¸ç”¨çš„kubernetes nodeså¤§éƒ¨ä»½éƒ½æ˜¯t2 type&lt;br&gt;å¥½è™•æ˜¯ä¾¿å®œã€å½ˆæ€§å¤§ï¼Œä½†å£è™•ä¹Ÿç›¸ç•¶æ˜é¡¯&lt;br&gt;ç•¶CPUä½¿ç”¨ç‡æ¯”CPU creditå›å¾©çš„é€Ÿåº¦æ…¢æ™‚ï¼Œæœ‰æ©Ÿæœƒå°è‡´cpu creditè®Šæˆ0(æˆ–è€…ç›¸ç•¶æ¥è¿‘0)&lt;br&gt;å°è‡´è©²ç¯€é»çš„CPUæ•ˆèƒ½é™åˆ°æ¥µä½ï¼Œå¤§éƒ¨ä»½é€²ç¨‹éƒ½æœƒå¡ä½ç”šè‡³ç•¶æ©Ÿ&lt;br&gt;é€™å€‹æƒ…æ³å·²ç¶“ç™¼ç”Ÿéä¸åªä¸€æ¬¡&lt;br&gt;ä¾‹å¦‚åœ¨æŸå€‹nodeä¸Šçš„rabbitmq(å°ï¼Œæ²’æœ‰ç”¨åˆ°dedicated çš„node)&lt;br&gt;å› ç‚ºæœ‰å€‹chromiumçš„podåœ¨åŒä¸€æ©Ÿå™¨ä¸Šè·‘ï¼Œè€Œä¸”ä»–æ˜¯ä»¥cron jobå½¢å¼å»è·‘ï¼Œå†åŠ ä¸Šæœ‰è©²æ­»bugï¼Œäº¦æ²’æœ‰è¨­å®šretry count&lt;br&gt;çµæœå°±æ˜¯å±±ç©äº†ä¸€å †jobåœ¨åŒä¸€å€‹nodeä¸Šä¸åœè·‘&lt;br&gt;éäº†å¹¾å¤©æ•´å€‹CPU creditè®Šæˆ0ï¼Œrabbitmqæ›æ‰&lt;br&gt;å¾ˆå¤šå…¶ä»–podä¹Ÿå› æ­¤å¡æ­»(æˆ–è€…ä¸æ–·é‡å•Ÿ)&lt;/p&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/tags/kubernetes/"/>
    
      <category term="aws" scheme="https://blog.nandiheath.com/tags/aws/"/>
    
      <category term="prometheus" scheme="https://blog.nandiheath.com/tags/prometheus/"/>
    
      <category term="t2.medium" scheme="https://blog.nandiheath.com/tags/t2-medium/"/>
    
      <category term="ec2" scheme="https://blog.nandiheath.com/tags/ec2/"/>
    
  </entry>
  
  <entry>
    <title>Citylineæ¶é£›</title>
    <link href="https://blog.nandiheath.com/2018/08/02/cityline-bot/"/>
    <id>https://blog.nandiheath.com/2018/08/02/cityline-bot/</id>
    <published>2018-08-02T03:02:58.000Z</published>
    <updated>2019-09-18T09:13:44.709Z</updated>
    
    <content type="html"><![CDATA[<p>é›£å¾—æœ‰æ¼”å”±æœƒæƒ³çœ‹ï¼Œä½†ä¸å¾—ä¸èªªCitylineçš„ç¶²ç«™çœŸçš„å¾ˆåƒåœ¾â€¦<br>åœ¨é€²å…¥è³¼ç¥¨é ä¹‹å‰ç«Ÿç„¶åŠ äº†ä¸€ç‰ˆâ€å¿™ç¢Œä¸­â€â€¦<br>æŠŠç”¨æˆ¶å…ˆå¡ä½äº†ï¼Œéœ€è¦ä½ æ‰‹å‹•å»é»é‚£å€‹â€retryâ€æŒ‰éˆ•<br>å”¯æœ‰å¯«å€‹å°ç¨‹åºå»ä¸€ç›´åˆ·â€¦<br><img src="/images/cityline-bot-0.png" alt=""></p><a id="more"></a><hr><h3 id="æ•™ç¨‹"><a href="#æ•™ç¨‹" class="headerlink" title="æ•™ç¨‹"></a>æ•™ç¨‹</h3><h4 id="ä¸‹è¼‰é€™å€‹chrome-plugin"><a href="#ä¸‹è¼‰é€™å€‹chrome-plugin" class="headerlink" title="ä¸‹è¼‰é€™å€‹chrome plugin"></a>ä¸‹è¼‰<a href="https://chrome.google.com/webstore/detail/user-javascript-and-css/nbhcbdghjpllgmfilhnhkllmkecfmpld?hl=en" target="_blank" rel="noopener">é€™å€‹chrome plugin</a></h4><p><img src="/images/cityline-bot-1.png" alt=""></p><ol start="2"><li>åœ¨citylineçš„ç¶²é ä¸­æ‰“é–‹é€™å€‹plugin</li><li>å‹¾é¸javascript åŠ jqeury3</li></ol><p><img src="/images/cityline-bot-2.png" alt=""></p><ol start="4"><li>æŠŠä¸‹é¢é€™æ®µç¨‹å¼ç¢¼è²¼ä¸Šå»</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PAGE_YOU_DONT_WANT_TO_SEE = <span class="string">'busy.html'</span>;</span><br><span class="line"><span class="keyword">const</span> RETRY_INTERVAL_IN_MS = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only execute one time</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// only applicable to busy.html</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.location.href.indexOf(PAGE_YOU_DONT_WANT_TO_SEE) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Enable the fucking retry button and click it</span></span><br><span class="line">    $(<span class="string">"#btn-retry-en-1"</span>).prop(<span class="string">'disabled'</span>, <span class="literal">false</span>);</span><br><span class="line">    $(<span class="string">"#btn-retry-en-1"</span>).click();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; , RETRY_INTERVAL_IN_MS);</span><br></pre></td></tr></table></figure><p>é€™å€‹å°ç¨‹åºæœƒæ¯éš”1ç§’æª¢æŸ¥ä½ ç•¶ä¸‹çš„ç¶²å€<br>ç•¶ç™¼è¦ºä½ è¢«å½ˆå»äº†<strong>æ­£åœ¨ç¹å¿™</strong>é€™ä¸€é æ™‚<br>å°±æœƒå¹«ä½ é»é‡åˆ·æŒ‰éˆ•</p><hr><p>ä½†å¯æƒœåˆ°æœ€å¾Œä»ç„¶è²·ä¸åˆ°ç¥¨â€¦â€¦</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é›£å¾—æœ‰æ¼”å”±æœƒæƒ³çœ‹ï¼Œä½†ä¸å¾—ä¸èªªCitylineçš„ç¶²ç«™çœŸçš„å¾ˆåƒåœ¾â€¦&lt;br&gt;åœ¨é€²å…¥è³¼ç¥¨é ä¹‹å‰ç«Ÿç„¶åŠ äº†ä¸€ç‰ˆâ€å¿™ç¢Œä¸­â€â€¦&lt;br&gt;æŠŠç”¨æˆ¶å…ˆå¡ä½äº†ï¼Œéœ€è¦ä½ æ‰‹å‹•å»é»é‚£å€‹â€retryâ€æŒ‰éˆ•&lt;br&gt;å”¯æœ‰å¯«å€‹å°ç¨‹åºå»ä¸€ç›´åˆ·â€¦&lt;br&gt;&lt;img src=&quot;/images/cityline-bot-0.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="dev" scheme="https://blog.nandiheath.com/categories/dev/"/>
    
    
      <category term="javascript" scheme="https://blog.nandiheath.com/tags/javascript/"/>
    
      <category term="bot" scheme="https://blog.nandiheath.com/tags/bot/"/>
    
  </entry>
  
  <entry>
    <title>Macä¸­çš„Cassandraå¡çˆ†äº†æ•´å€‹hard disk</title>
    <link href="https://blog.nandiheath.com/2018/07/30/mac-cassandra-disk-full/"/>
    <id>https://blog.nandiheath.com/2018/07/30/mac-cassandra-disk-full/</id>
    <published>2018-07-30T05:01:06.000Z</published>
    <updated>2019-09-18T09:13:44.716Z</updated>
    
    <content type="html"><![CDATA[<p>åŸå› æ˜¯cassandra çš„commit log å› ç‚ºä¸çŸ¥åçš„åŸå› (å¯èƒ½æ˜¯è¢«æ‹”æ‰é›»æºä¹‹å¾Œçš„failover?)<br>ä¸æ–·å¢åŠ commit logï¼Œå°è‡´çŸ­çŸ­å…©å¤©æŠŠæ•´å€‹ç¡¬ç¢Ÿéƒ½å¡çˆ†äº†(~630GB)<br>æ›´åŠ ä»¤åˆ°macä¸­çš„accountæ•´å€‹æ¶ˆå¤±æ‰<br>æ‰€ä»¥åœ¨macä¸­å®‰è£cassandraç·Šè¨˜è¦limit commit log çš„size ..</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Edit cassandra config file</span></span><br><span class="line">vi /usr/<span class="built_in">local</span>/etc/cassandra/cassandra.yaml</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&gt; cassandra.yaml:</span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment the following line to limit the total file size</span></span><br><span class="line">commitlog_total_space_in_mb: 8192</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŸå› æ˜¯cassandra çš„commit log å› ç‚ºä¸çŸ¥åçš„åŸå› (å¯èƒ½æ˜¯è¢«æ‹”æ‰é›»æºä¹‹å¾Œçš„failover?)&lt;br&gt;ä¸æ–·å¢åŠ commit logï¼Œå°è‡´çŸ­çŸ­å…©å¤©æŠŠæ•´å€‹ç¡¬ç¢Ÿéƒ½å¡çˆ†äº†(~630GB)&lt;br&gt;æ›´åŠ ä»¤åˆ°macä¸­çš„accountæ•´å€‹æ¶ˆå¤±æ‰&lt;br&gt;æ‰€ä»¥åœ¨macä¸­å®‰è£ca
      
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
    
      <category term="cassandra" scheme="https://blog.nandiheath.com/tags/cassandra/"/>
    
  </entry>
  
  <entry>
    <title>linuxåº•ä¸‹çš„logrotate</title>
    <link href="https://blog.nandiheath.com/2018/05/14/nginx-log-rotate/"/>
    <id>https://blog.nandiheath.com/2018/05/14/nginx-log-rotate/</id>
    <published>2018-05-13T19:29:30.000Z</published>
    <updated>2019-09-18T09:13:44.716Z</updated>
    
    <content type="html"><![CDATA[<p>å› ç‚ºä¹‹å‰æŠŠä¸€å †æ±è¥¿éƒ½åŠ åˆ°å»nginxçš„access logè£¡å»(headers/device_id/etc.)<br>çµæœè¶…å·¨é‡çš„logæŠŠç¡¬ç¢Ÿæ•´å€‹å¡çˆ†äº†â€¦<br>æ‰€ä»¥å°±ç ”ç©¶äº†ä¸‹æœ‰æ²’æœ‰ç°¡å–®çš„log rotationæ–¹æ¡ˆå¯ä»¥ç”¨</p><h2 id="Linuxä¸‹çš„logrotate"><a href="#Linuxä¸‹çš„logrotate" class="headerlink" title="Linuxä¸‹çš„logrotate"></a>Linuxä¸‹çš„logrotate</h2><p>linuxä¸Šæœ¬èº«å·²æœ‰çš„logrotateåŠŸèƒ½<br>ç°¡å–®è¨­å®šå°±å¯ä»¥è‡ªå‹•æ¯å¤©é€²è¡Œlog rotation</p><h3 id="è¨­å®š"><a href="#è¨­å®š" class="headerlink" title="è¨­å®š"></a>è¨­å®š</h3><p>æ–°å¢ä¸€å€‹è¨­å®šæª”åˆ° /etc/logrotate.d/nginx</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">  daily # æ¯å¤©è·‘ä¸€æ¬¡</span><br><span class="line">  compress # å£“ç¸®æˆgz</span><br><span class="line">  delaycompress </span><br><span class="line">  rotate 3 # æ¯3è¼ªå°±æœƒrotateä¸€æ¬¡</span><br><span class="line">  missingok # ä¸å­˜åœ¨ä¹Ÿæ˜¯OKçš„ï¼</span><br><span class="line">  nocreate</span><br><span class="line">  sharedscripts</span><br><span class="line">  postrotate # rotateå®Œä¹‹å¾Œçš„å‹•ä½œ</span><br><span class="line">    [ -f /var/run/nginx.pid ] &amp;&amp; kill -USR1 `cat /var/run/nginx.pid`</span><br><span class="line">  endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ç•™æ„kill -USR1 nginxä¸æ˜¯è¦é—œæ‰nginxï¼Œè€Œæ˜¯é€ésingalå»é€šçŸ¥nginx é‡é–‹log file<br>ç›´æ¥è·‘ä»¥ä¸‹å‘½ä»¤é‹è¡Œæ¸¬è©¦</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">logrotate -f -v /etc/logrotate.d/nginx</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¾Œå°±æœƒçœ‹åˆ°ä¸€å€‹access.log.1æˆ–è€…access.log.2.gz</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li><a href="http://nginx.org/en/docs/control.html" target="_blank" rel="noopener">http://nginx.org/en/docs/control.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å› ç‚ºä¹‹å‰æŠŠä¸€å †æ±è¥¿éƒ½åŠ åˆ°å»nginxçš„access logè£¡å»(headers/device_id/etc.)&lt;br&gt;çµæœè¶…å·¨é‡çš„logæŠŠç¡¬ç¢Ÿæ•´å€‹å¡çˆ†äº†â€¦&lt;br&gt;æ‰€ä»¥å°±ç ”ç©¶äº†ä¸‹æœ‰æ²’æœ‰ç°¡å–®çš„log rotationæ–¹æ¡ˆå¯ä»¥ç”¨&lt;/p&gt;
&lt;h2 id=&quot;Linuxä¸‹çš„logrotate&quot;&gt;&lt;a href=&quot;#Linuxä¸‹çš„logrotate&quot; class=&quot;headerlink&quot; title=&quot;Linuxä¸‹çš„logrotate&quot;&gt;&lt;/a&gt;Linuxä¸‹çš„logrotate&lt;/h2&gt;&lt;p&gt;linuxä¸Šæœ¬èº«å·²æœ‰çš„logrotateåŠŸèƒ½&lt;br&gt;ç°¡å–®è¨­å®šå°±å¯ä»¥è‡ªå‹•æ¯å¤©é€²è¡Œlog rotation&lt;/p&gt;
&lt;h3 id=&quot;è¨­å®š&quot;&gt;&lt;a href=&quot;#è¨­å®š&quot; class=&quot;headerlink&quot; title=&quot;è¨­å®š&quot;&gt;&lt;/a&gt;è¨­å®š&lt;/h3&gt;&lt;p&gt;æ–°å¢ä¸€å€‹è¨­å®šæª”åˆ° /etc/logrotate.d/nginx&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/var/log/nginx/*.log &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  daily # æ¯å¤©è·‘ä¸€æ¬¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  compress # å£“ç¸®æˆgz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  delaycompress &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  rotate 3 # æ¯3è¼ªå°±æœƒrotateä¸€æ¬¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  missingok # ä¸å­˜åœ¨ä¹Ÿæ˜¯OKçš„ï¼&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  nocreate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sharedscripts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  postrotate # rotateå®Œä¹‹å¾Œçš„å‹•ä½œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [ -f /var/run/nginx.pid ] &amp;amp;&amp;amp; kill -USR1 `cat /var/run/nginx.pid`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  endscript&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="devops" scheme="https://blog.nandiheath.com/categories/devops/"/>
    
      <category term="kubernetes" scheme="https://blog.nandiheath.com/categories/devops/kubernetes/"/>
    
    
      <category term="nginx" scheme="https://blog.nandiheath.com/tags/nginx/"/>
    
      <category term="logrotate" scheme="https://blog.nandiheath.com/tags/logrotate/"/>
    
  </entry>
  
</feed>
